
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Calculating Accrued Interest &#8212; Basic Bond Concepts and the Term Structure of Interest Rates</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter_Two_Accrued_Interest';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Manipulating Dates" href="Dealing_With_Dates.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/Small_Logo.svg" class="logo__image only-light" alt="Basic Bond Concepts and the Term Structure of Interest Rates - Home"/>
    <script>document.write(`<img src="_static/Small_Logo.svg" class="logo__image only-dark" alt="Basic Bond Concepts and the Term Structure of Interest Rates - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Financial Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="Chapter_Two_Highlights.html">Accrued Interest</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Machanics_Of_Bond_Pricces.html"><span style="font-family:Franklin Gothic Medium', sans-serif;">The Mechanics Of Bond Pricing</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="Dealing_With_Dates.html">Manipulating Dates</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Calculating Accrued Interest</a></li>

</ul><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/PatrickJHess/Vol-3-Chap-2-Chap-3/master?urlpath=tree/Chapter_Two_Accrued_Interest.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/PatrickJHess/Vol-3-Chap-2-Chap-3/blob/master/Chapter_Two_Accrued_Interest.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>



<a href="https://github.com/PatrickJHess/Vol-3-Chap-2-Chap-3/issues/new?title=Issue%20on%20page%20%2FChapter_Two_Accrued_Interest.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button"
   title="Open an issue"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Chapter_Two_Accrued_Interest.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Calculating Accrued Interest</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Calculating Accrued Interest</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-notebook">Preparing The Notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-libraries-modules-and-functions">Importing Libraries, Modules, And Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-a-custom-module-and-importing-functions">Adding A Custom Module And Importing Functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-the-dataframe-bond-data">Creating The DataFrame bond_data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#illustrating-accrued-interest-with-five-unique-maturity-dates">Illustrating Accrued Interest With Five Unique Maturity Dates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-access-bonds-with-specific-characteristics"><font color="green">Application:Access Bonds With Specific Characteristics</font></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determining-the-next-coupon-date">Determining The Next Coupon Date</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-if-settlement-or-maturity-date-is-month-end">Determine If Settlement Or Maturity Date Is Month End</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#last-day-month-function">last_day_month() Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-next-coupon-period">The Next Coupon Period</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-function-calculating-the-settlement-year-maturity-month-and-day">A Function Calculating The Settlement Year, Maturity Month, And Day</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-the-results-of-settle-year-mat">Checking The Results Of settle_year_mat()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-function-returning-the-next-and-last-coupon-date">A Function Returning The Next And Last Coupon Date</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-the-results-of-next-last-coupon-dates">Checking The Results Of next_last_coupon_dates()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-days-between-coupon-and-payment-dates"><font color="green">Application:Days Between Coupon And Payment Dates</font></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Calculating Accrued Interest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quck-look-at-pandas-apply-method">A Quck Look At Pandas apply Method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update-bond-data-with-accrued-interest">Update Bond Data With Accrued Interest</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-calculate-a-transaction-price"><font color="green">Application:Calculate A Transaction Price</font></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-the-workbook">Creating The Workbook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-default-path">The Default Path</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-create-an-excel-workbook"><font color="green">Application:Create An Excel Workbook</font></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-exercise"><span style="text-align: left; color:green; font-family: 'Franklin Gothic Medium', sans-serif; margin-top: 1.0em; margin-bottom: 0em; font-style: italic;">Chapter Exercise</span></a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="calculating-accrued-interest">
<h1>Calculating Accrued Interest<a class="headerlink" href="#calculating-accrued-interest" title="Link to this heading">#</a></h1>
<section id="preparing-the-notebook">
<h2>Preparing The Notebook<a class="headerlink" href="#preparing-the-notebook" title="Link to this heading">#</a></h2>
<section id="importing-libraries-modules-and-functions">
<h3>Importing Libraries, Modules, And Functions<a class="headerlink" href="#importing-libraries-modules-and-functions" title="Link to this heading">#</a></h3>
<p>As in Chapter One of the volume, modules that are included in the standard Python library are imported. When necessary, other modules or libraries are installed before they are imported.<span class="math notranslate nohighlight">\(^{1}\)</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import os
import sys
import requests
from datetime import datetime, date
from types import ModuleType

try:
    import numpy as np
except:
    !pip install numpy
    import numpy as np

try:
    import pandas as pd
except:
    !pip install pandas
    import pandas as pd

try:
    from dateutil.relativedelta import relativedelta
except:
    !pip install python-dateutil
    from dateutil.relativedelta import relativedelta

</pre></div>
</div>
<hr class="docutils" />
<p><span class="math notranslate nohighlight">\(^{1}\)</span><a href='https://patrickjhess.github.io/Introduction-To-Python-For-Financial-Python/Control_Statements.html#the-try-and-except'>try and except statements</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import OS to interact with local computer operating system</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModuleType</span>
<span class="c1"># Import the datetime and date classes from the datetime module for working with dates.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">date</span>
<span class="c1"># Last calendar day of the month and day of the week for first day</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
<span class="c1"># Import the numpu library for data manipulation and analysis, aliased as np</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>numpy
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="c1"># Import the pandas library for data manipulation and analysis, aliased as pd.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pandas
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Import the relativedelta class from dateutil for advanced date calculations.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>python-dateutil
    <span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>

<span class="c1"># Import the relativedelta class from dateutil for advanced date calculations.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>python-dateutil
    <span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="adding-a-custom-module-and-importing-functions">
<h3>Adding A Custom Module And Importing Functions<a class="headerlink" href="#adding-a-custom-module-and-importing-functions" title="Link to this heading">#</a></h3>
<p>Like Chapter One the custom module <font color='green'>module_basic_concepts_fixed_income</font> custom module  is accessed from Dropbox and named <font color='green'>basic_concepts_fixed_income</font>.  As a reminder, the module is accessible in the notebook’s memory, but is not added to a drive.  Two functions are added to the notebook.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">basic_income_module</span><span class="p">(</span><span class="n">accrued_interest</span><span class="p">,</span>
                         <span class="n">create_workbook</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><font color='green'>accrured_interest()</font> <a class="reference external" href="https://patrickjhess.github.io/Imported-Functions/accrued_interest.html#accrued-interest-is-a-helper-function-that-calculates-accrued-interest">view here</a>.</p></li>
<li><p><font color='green'>create_workbook() <a class="reference external" href="https://patrickjhess.github.io/Imported-Functions/create_workbook.html#create-workbook-is-a-helper-function-that-creates-excel-workbooks-from-dataframes-created-by-financial-python">view here</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the URL of the Python module to be downloaded from Dropbox.</span>
<span class="c1"># The &#39;dl=1&#39; parameter in the URL forces a direct download of the file content.</span>
<span class="n">url</span><span class="o">=</span> <span class="s1">&#39;https://www.dropbox.com/scl/fi/4y5hjxlfphh1ngvbgo77q/</span><span class="se">\</span>
<span class="s1">module_-basic_concepts_fixed_income.py?rlkey=6oxi7mgka42veaat79hcv8boz&amp;st=87sztshr&amp;dl=1&#39;</span>
<span class="n">module_name</span><span class="o">=</span><span class="s1">&#39;basic_concepts_fixed_income&#39;</span>
<span class="c1"># Send an HTTP GET request to the URL and store the server&#39;s response.</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="c1"># Raise an exception for bad status codes (like 404 Not Found)</span>
  <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
  <span class="n">module</span><span class="o">=</span> <span class="n">ModuleType</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
  <span class="c1">#Code contained in response.text executed</span>
  <span class="n">exec</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
  <span class="c1"># Module added to sys</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span><span class="o">=</span><span class="n">module</span>
<span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Error: Could not fetch module from URL. </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Error: Failed to execute or import the module. </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Now that &#39;basic_concepts_fixed_income&#39; exists in the notebook, import the specific functions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">basic_concepts_fixed_income</span><span class="w"> </span><span class="kn">import</span><span class="p">(</span><span class="n">accrued_interest</span><span class="p">,</span>
                                        <span class="n">create_workbook</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Blue">notice</span><span class=" -Color -Color-Bold">]</span> A new release of pip is available: <span class=" -Color -Color-Red">25.2</span> -&gt; <span class=" -Color -Color-Green">25.3</span>
<span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Blue">notice</span><span class=" -Color -Color-Bold">]</span> To update, run: <span class=" -Color -Color-Green">pip install --upgrade pip</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="creating-the-dataframe-bond-data">
<h2>Creating The DataFrame bond_data<a class="headerlink" href="#creating-the-dataframe-bond-data" title="Link to this heading">#</a></h2>
<p><font color='black'> U.S. Treasury notes and bonds data, for settlement on January 21, 2025, was obtained from Fidelity. The Fidelity data, an Excel workbook, is downloaded from DropBox using the Panda’s <font color='green'>read_excel()</font> method.<span class="math notranslate nohighlight">\(^{1}\)</span></p>
<p>Three arguments are pass to the method.</p>
<ol class="arabic simple">
<li><p>The URL address (<font color='green'>url</font>) is required.</p></li>
<li><p>Assigning the index column is optional. The maturity dates, located in the first column, are set as the index of the DataFrame  (<font color='green'>index_col=’Maturity Date’</font>).</p></li>
<li><p>The worksheet name defaults to the first worksheet. The worksheet’s name, ‘Fidelity Data’, is assigned to <font color='green'>’sheet_name’ (<font color='green'>sheet_name=’Fidelity Data</font>).</p></li>
</ol>
<p>The <font color='green'>display()</font>  function shows the first and last five rows confirming that data has been successfully accessed.</p>
<hr class="docutils" />
<p><span class="math notranslate nohighlight">\(^{1}\)</span> <a href='https://patrickjhess.github.io/Introduction-To-Python-For-Financial-Python/An_Introduction_To_Pandas.html#dataframes-csv-and-excel-files'>Pandas method read_excel</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#The full file path.</span>
<span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://www.dropbox.com/scl/fi/lgnaj41bt8o9sv5a63rr1/</span><span class="se">\</span>
<span class="s1">bond_data_jan21_2025.xlsx?rlkey=twjzkcqo0g2ahvot78518ti4x&amp;st=ihc5feog&amp;dl=1&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting to load data from: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1">#Load the data from Excel, using the first column as the index.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">bond_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Maturity Date&#39;</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Fidelity Data&#39;</span><span class="p">)</span>

    <span class="c1"># Display the first and last 5 rows of the loaded DataFrame to verify it worked..</span>
    <span class="n">display</span><span class="p">(</span><span class="n">bond_data</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: File not found.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check that the &#39;folder&#39; and &#39;file&#39; variables are spelled correctly&#39;</span><span class="se">\</span>
<span class="s2">&#39; and that the file exists in that location.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Attempting to load data from: https://www.dropbox.com/scl/fi/lgnaj41bt8o9sv5a63rr1/bond_data_jan21_2025.xlsx?rlkey=twjzkcqo0g2ahvot78518ti4x&amp;st=ihc5feog&amp;dl=1
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
      <th>Coupon</th>
      <th>Price Bid</th>
      <th>Price Ask</th>
      <th>Bid Size</th>
      <th>Ask Size</th>
    </tr>
    <tr>
      <th>Maturity Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2025-01-28</th>
      <td>UNITED STATES TREAS BILLS ZERO CPN       0.000...</td>
      <td>0.000</td>
      <td>99.929</td>
      <td>99.930</td>
      <td>100000.0</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>2025-01-30</th>
      <td>UNITED STATES TREAS BILLS ZERO CPN       0.000...</td>
      <td>0.000</td>
      <td>99.906</td>
      <td>99.907</td>
      <td>40000.0</td>
      <td>40000.0</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER U-2025          1.3750...</td>
      <td>1.375</td>
      <td>99.921</td>
      <td>99.934</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER AW-2025         4.1250...</td>
      <td>4.125</td>
      <td>99.988</td>
      <td>99.997</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER G-2025          2.5000...</td>
      <td>2.500</td>
      <td>99.953</td>
      <td>99.965</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2029-11-30</th>
      <td>UNITED STATES TREAS SER AG-2029         4.1250...</td>
      <td>4.125</td>
      <td>98.910</td>
      <td>98.914</td>
      <td>100000.0</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>2029-11-30</th>
      <td>UNITED STATES TREAS SER S-2029          3.8750...</td>
      <td>3.875</td>
      <td>97.763</td>
      <td>97.782</td>
      <td>40000.0</td>
      <td>40000.0</td>
    </tr>
    <tr>
      <th>2029-12-31</th>
      <td>UNITED STATES TREAS SER T-2029          3.8750...</td>
      <td>3.875</td>
      <td>97.734</td>
      <td>97.738</td>
      <td>65000.0</td>
      <td>65000.0</td>
    </tr>
    <tr>
      <th>2029-12-31</th>
      <td>UNITED STATES TREAS SER AH-2029         4.3750...</td>
      <td>4.375</td>
      <td>99.988</td>
      <td>99.989</td>
      <td>7000.0</td>
      <td>7000.0</td>
    </tr>
    <tr>
      <th>2030-01-31</th>
      <td>UNITED STATES TREAS SER G-2030          3.5000...</td>
      <td>3.500</td>
      <td>95.994</td>
      <td>96.011</td>
      <td>16000.0</td>
      <td>16000.0</td>
    </tr>
  </tbody>
</table>
<p>304 rows × 6 columns</p>
</div></div></div>
</div>
</section>
<section id="illustrating-accrued-interest-with-five-unique-maturity-dates">
<h2>Illustrating Accrued Interest With Five Unique Maturity Dates<a class="headerlink" href="#illustrating-accrued-interest-with-five-unique-maturity-dates" title="Link to this heading">#</a></h2>
<p><font color='black'> Two time periods are required to calculate accrued interest:</p>
<ol class="arabic simple">
<li><p>the time remaining until the next payment,</p></li>
<li><p>the time between the next and previous payments.</p></li>
</ol>
<p>Until it matures, a coupon bond makes a payment every year on the anniversary of its maturity date. Consider a semi-annual bond maturing in a future year on April 30<span class="math notranslate nohighlight">\(^{th}\)</span>. Before April 30<span class="math notranslate nohighlight">\(^{th}\)</span> of the current year, the next payment date will be April 30<span class="math notranslate nohighlight">\(^{th}\)</span> of the current year. April 30<span class="math notranslate nohighlight">\(^{th}\)</span> is a month-end as are all other the payment dates. The previous payment date is October 31<span class="math notranslate nohighlight">\(^{st}\)</span> of the previous year. After April 30<span class="math notranslate nohighlight">\(^{th}\)</span>, the next payment date is October 31<span class="math notranslate nohighlight">\(^{st}\)</span> and the previous April 30<span class="math notranslate nohighlight">\(^{th}\)</span>.</p>
<p>Five maturity dates are selected to illustrate the calculations. The fifth bond matures on February 29<span class="math notranslate nohighlight">\(^{th}\)</span> in a leap year.  The current settlement date is January 21<span class="math notranslate nohighlight">\(^{st}\)</span> 2025 and February 29<span class="math notranslate nohighlight">\(^{th}\)</span> doesn’t exist in 2025.  Controlling for month-end, however, will automatically adjust the coupon payment date to February 28 in 2025.</p>
<ul class="simple">
<li><p>February 28<span class="math notranslate nohighlight">\(^{th}\)</span> 2025</p></li>
<li><p>July 15<span class="math notranslate nohighlight">\(^{th}\)</span> 2025</p></li>
<li><p>August 31<span class="math notranslate nohighlight">\(^{st}\)</span> 2025</p></li>
<li><p>January 15<span class="math notranslate nohighlight">\(^{th}\)</span> 2026</p></li>
<li><p>February 29<span class="math notranslate nohighlight">\(^{th}\)</span> 2028</p></li>
</ul>
<p>The <font color='green'>loc</font> attribute is utilized to identify the bonds with the five maturity dates. The <font color='green'>sample_bonds</font> DataFrame includes several bonds with the same maturity date. The Pandas method <font color='green'>duplicated()</font> selects the the first instances of the bonds resulting in five bonds with unique maturity dates.<span class="math notranslate nohighlight">\(^{2}\)</span></p>
<p><font color='green'>sample_bonds</font></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maturity_dates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2026</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2028</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span>
<span class="n">sample_bonds</span><span class="o">=</span><span class="n">bond_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">maturity_dates</span><span class="p">]</span>
<span class="n">unique_bond</span><span class="o">=</span> <span class="o">~</span><span class="n">all_sample_bonds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
<span class="n">five_bonds</span><span class="o">=</span><span class="n">sample_bonds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unique_bonds</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">five_bonds</span><span class="p">)</span>


</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(^{2}\)</span> <a href='https://patrickjhess.github.io/Introduction-To-Python-For-Financial-Python/An_Introduction_To_Pandas.html#pandas-duplicated-method'>The Pandas Method duplicated</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Define a specific list of upcoming bond maturity dates to analyze ---</span>
<span class="c1"># These dates were selected for a targeted review of bonds maturing in</span>
<span class="c1"># late 2025 and early 2026.</span>
<span class="n">maturity_dates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2026</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2028</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># Use the .loc indexer to perform a label-based lookup.</span>
<span class="c1"># This retrieves all rows where the DataFrame&#39;s index exactly matches the dates in the list.</span>
<span class="n">sample_bonds</span> <span class="o">=</span> <span class="n">bond_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">maturity_dates</span><span class="p">]</span>
<span class="c1"># ~ negates the value of duplicated..the maturity is unique</span>
<span class="c1"># keep the first instance that is not a duplicate...a unique index is unmodified</span>
<span class="n">unique_bonds</span><span class="o">=</span> <span class="o">~</span><span class="n">sample_bonds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
<span class="n">five_bonds</span><span class="o">=</span><span class="n">sample_bonds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unique_bonds</span><span class="p">]</span>

<span class="c1"># Render the resulting &#39;five_bonds&#39; DataFrame as a formatted table in the output.</span>
<span class="n">display</span><span class="p">(</span><span class="n">five_bonds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
      <th>Coupon</th>
      <th>Price Bid</th>
      <th>Price Ask</th>
      <th>Bid Size</th>
      <th>Ask Size</th>
    </tr>
    <tr>
      <th>Maturity Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2025-02-28</th>
      <td>UNITED STATES TREAS NOTE 1.12500% 02/28/2025</td>
      <td>1.125</td>
      <td>99.671</td>
      <td>99.684</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>2025-07-15</th>
      <td>UNITED STATES TREAS SER AQ-2025         3.0000...</td>
      <td>3.000</td>
      <td>99.394</td>
      <td>99.406</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>2025-08-31</th>
      <td>UNITED STATES TREAS SER AC-2025         0.2500...</td>
      <td>0.250</td>
      <td>97.605</td>
      <td>97.610</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>2026-01-15</th>
      <td>UNITED STATES TREAS SER AJ-2026         3.8750...</td>
      <td>3.875</td>
      <td>99.671</td>
      <td>99.688</td>
      <td>40000.0</td>
      <td>40000.0</td>
    </tr>
    <tr>
      <th>2028-02-29</th>
      <td>UNITED STATES TREAS SER V-2028          4.0000...</td>
      <td>4.000</td>
      <td>99.099</td>
      <td>99.118</td>
      <td>40000.0</td>
      <td>40000.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="application-access-bonds-with-specific-characteristics">
<h2><font color='green'>Application:Access Bonds With Specific Characteristics</font><a class="headerlink" href="#application-access-bonds-with-specific-characteristics" title="Link to this heading">#</a></h2>
<p><span style="display:block;background-color:LightGray;
    border-left: 12px solid green;
    font-family: 'Garamond', serif;
    line-height: 1.5;
    padding: 15px">
<br>
Access the bonds that mature at the end of April and October 2025. Create a DataFrame of the bonds with a coupon greater than 3.5. For hints, see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Hints.html#access-bonds-with-specific-characteristics">Chapter Two Hints:Access Bonds With Specific Characteristics</a>, and check the <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Results.html#access-bonds-with-specific-characteristics">expected results here</a>.
<br>
<br>
</span></p>
<section id="determining-the-next-coupon-date">
<h3>Determining The Next Coupon Date<a class="headerlink" href="#determining-the-next-coupon-date" title="Link to this heading">#</a></h3>
<p><font color='black'> Government notes and bonds make semi-annual payments.  When a coupon bond is purchased, the next coupon payment date will be within six months of the settlement date.
In this example the settlement date is January 21<span class="math notranslate nohighlight">\(^{st}\)</span> 2025 making the next coupon date falling between January 21<span class="math notranslate nohighlight">\(^{st}\)</span> 2025 <br>and July 21<span class="math notranslate nohighlight">\(^{st}\)</span> 2025. If the maturity  month and day of the security is between January 21<span class="math notranslate nohighlight">\(^{st}\)</span> and July 21<span class="math notranslate nohighlight">\(^{st}\)</span>, the next coupon payment date will be the maturity month and day in 2025.  The exception to this is the bond that matures on February 29<span class="math notranslate nohighlight">\(^{th}\)</span> 2028.  Because of the month-end maturity, it’s next coupon date is adjusted to February 28<span class="math notranslate nohighlight">\(^{th}\)</span> 2025.</p>
<img src='https://docs.google.com/drawings/d/e/2PACX-1vS1L8ZT3QiCyUdLd8kddTgsgqGHUp7u8d1nUDZ4KhiIMTuHrPq1Jc3dpfmSmgbaI6bd4EPLnTqEKJj4/pub?w=960&h=720'></section>
<section id="determine-if-settlement-or-maturity-date-is-month-end">
<h3>Determine If Settlement Or Maturity Date Is Month End<a class="headerlink" href="#determine-if-settlement-or-maturity-date-is-month-end" title="Link to this heading">#</a></h3>
<p>The maturity dates of five_bonds are Panda’s timestamps with the attribute <font color='green'>is_month_end</font>.  The settlement date is converted to a Pandas timestamp.<span class="math notranslate nohighlight">\(^{3}\)</span>  The maturities and settlemen dates are check for month end.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Month-End Status Of Five Maturity Dates </span><span class="si">{</span><span class="n">five_bond</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_month_end</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">settlement_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Month-End Status Of Settlement Date </span><span class="si">{</span><span class="n">settlement_date</span><span class="o">.</span><span class="n">is_month_end</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

</pre></div>
</div>
<hr class="docutils" />
<p><span class="math notranslate nohighlight">\(^{3}\)</span> <a class="reference external" href="https://patrickjhess.github.io/Introduction-To-Python-For-Financial-Python/An_Introduction_To_Pandas.html#pandas-to-timestamp-method">Pandas Timestamp method</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For a collection of dates (a DatetimeIndex), .is_month_end returns a boolean array (True or False values).</span>
<span class="c1"># Here, we check each maturity date in the &#39;five_bonds&#39; index and print the resulting array.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Month-End Status Of Five Maturity Dates </span><span class="si">{</span><span class="n">five_bonds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_month_end</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Define a single, specific date (January 21, 2025) as a Pandas Timestamp object.</span>
<span class="c1"># This is a standard way to represent a single point in time for financial calculations.</span>
<span class="n">settlement_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>

<span class="c1"># For a single Timestamp, .is_month_end returns a single boolean value (True or False).</span>
<span class="c1"># We check if our settlement date falls on the last day of its month and print the result.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Month-End Status Of Settlement Date </span><span class="si">{</span><span class="n">settlement_date</span><span class="o">.</span><span class="n">is_month_end</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Month-End Status Of Five Maturity Dates [ True False  True False  True]
Month-End Status Of Settlement Date False
</pre></div>
</div>
</div>
</div>
</section>
<section id="last-day-month-function">
<h3>last_day_month() Function<a class="headerlink" href="#last-day-month-function" title="Link to this heading">#</a></h3>
<p>The <font color='green'>last_day_month()</font> function adjusts bond date calculations that require accommodation for the final day of the month.  The <font color='green'>monthrange()</font> method of calendar returns a tuple with the day of the week of the first day and last calendar day of a month.  The last day of the month is selected with the index value of one. The function returns the datetime using the last day of the month.  A datetime object is created with the year (date.year) and month (date.month) of the original date, but the day is the last day of date.month.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">last_day_month</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">):</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
  <span class="n">month_end_day</span><span class="o">=</span><span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">,</span><span class="n">datetime</span><span class="p">):</span>  
    <span class="k">return</span> <span class="n">datetime</span><span class="p">(</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">month_end_day</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">date</span><span class="p">(</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">month_end_day</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">last_day_month</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;&#39;</span>
<span class="sd">  Returns the  last day of the month for the given datetime object.</span>

<span class="sd">  Args:</span>
<span class="sd">    datetime_obj: A datetime object.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A datetime object representing the last day of the month</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span><span class="n">date</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
  <span class="c1"># Find the total number of days in the given month and year.</span>
  <span class="c1"># calendar.monthrange(year, month) returns a tuple: (weekday_of_first_day, num_days_in_month)</span>
  <span class="c1"># For example, for January 2025, it returns (2, 31). We need the second value.</span>
  <span class="n">month_end_day</span><span class="o">=</span><span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">,</span><span class="n">datetime</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="p">(</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">month_end_day</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">date</span><span class="p">(</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">datetime_obj</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">month_end_day</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-next-coupon-period">
<h3>The Next Coupon Period<a class="headerlink" href="#the-next-coupon-period" title="Link to this heading">#</a></h3>
<p>The end of the next coupon period is determined by adding the number of months between payments to the settlement date.  In these examples the bonds pay semi-annually and the number of months between payments is six. The end of the next coupon period is calculated with <font color='green'>relativedelta()</font>. If the settlement date is a month end, the last day of the date range is adjusted for month end with the <font color='green'>last_day()</font> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num_months</span><span class="o">=</span><span class="mi">12</span><span class="o">//</span><span class="mi">2</span>
<span class="n">range_start</span><span class="o">=</span><span class="n">settlement_date</span>
<span class="n">range_end</span><span class="o">=</span><span class="n">settlement_date</span><span class="o">+</span><span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>
<span class="n">settlement_month_end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">settlement_date</span><span class="p">)</span><span class="o">.</span><span class="n">is_month_end</span>
<span class="k">if</span> <span class="n">settlement_month_end</span><span class="p">:</span> <span class="n">range_end</span><span class="o">=</span><span class="n">last_day</span><span class="p">(</span><span class="n">range_end</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">range_start</span><span class="p">,</span><span class="n">range_end</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Semi-annual bonds so number of months is 6 (12/2 with floor division // )</span>
<span class="n">num_months</span> <span class="o">=</span> <span class="mi">12</span><span class="o">//</span> <span class="mi">2</span>

<span class="c1"># Set the starting point of our date range from the settlement date.</span>
<span class="c1"># Set end date with relativedelts</span>
<span class="n">range_start</span> <span class="o">=</span> <span class="n">settlement_date</span>
<span class="n">range_end</span> <span class="o">=</span> <span class="n">range_start</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>

<span class="c1"># month_end adjustment</span>
<span class="n">range_start_month_end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">range_start</span><span class="p">)</span><span class="o">.</span><span class="n">is_month_end</span>

<span class="k">if</span> <span class="n">range_start_month_end</span><span class="p">:</span>
  <span class="c1"># The `last_day` helper function enforces the EOM rule on our calculated end_date.</span>
  <span class="c1"># This correctly handles cases like Jan 31 + 1 month -&gt; Feb 28.</span>
  <span class="n">range_end</span> <span class="o">=</span> <span class="n">last_day_month</span><span class="p">(</span><span class="n">range_end</span><span class="p">)</span>

<span class="c1"># Display the final start and end dates to verify the result.</span>
<span class="n">display</span><span class="p">(</span><span class="n">range_start</span><span class="p">,</span> <span class="n">range_end</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;2025-01-21 00:00:00&#39;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;2025-07-21 00:00:00&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-function-calculating-the-settlement-year-maturity-month-and-day">
<h3>A Function Calculating The Settlement Year, Maturity Month, And Day<a class="headerlink" href="#a-function-calculating-the-settlement-year-maturity-month-and-day" title="Link to this heading">#</a></h3>
<p>The <font color='green'>settle_year_mat()</font> function calculates the anniversary of the maturity date within the settlement year. It takes the maturity and settlement dates as arguments, with the settlement date defaulting to the current date. This function utilizes <font color='green'>monthrange()</font> from the <font color='green'>calendar</font> module, If necessary, the function adjusts the settlement year date to account for month-end.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">settle_year_mat</span><span class="p">(</span><span class="n">maturity_date</span><span class="p">,</span> <span class="n">settlement</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
  <span class="k">if</span> <span class="n">settlement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">settlement</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
  <span class="n">year</span><span class="o">=</span><span class="n">settlement</span><span class="o">.</span><span class="n">year</span>
  <span class="n">days_in_month</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">maturity_date</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">end_month</span> <span class="o">=</span> <span class="p">(</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">days_in_month</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">end_month</span><span class="p">:</span><span class="n">day</span><span class="o">=</span><span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span><span class="n">day</span><span class="o">=</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">day</span>
  <span class="k">return</span> <span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">),</span><span class="n">end_month</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">settle_year_mat</span><span class="p">(</span><span class="n">maturity_date</span><span class="p">,</span> <span class="n">settlement</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Returns the maturity date in the settlement Year and month_end boolean value</span>
<span class="sd">    Args:</span>
<span class="sd">    maturity_date required and is a datetime.</span>
<span class="sd">    Default value of settlement is current year</span>

<span class="sd">  Returns:</span>
<span class="sd">     datetime object and boolean value</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span><span class="n">date</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>


  <span class="c1"># Determine year for settlement</span>
  <span class="k">if</span> <span class="n">settlement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">settlement</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
  <span class="n">year</span><span class="o">=</span><span class="n">settlement</span><span class="o">.</span><span class="n">year</span>

  <span class="c1"># Get the total number of days in the given month and year</span>
  <span class="n">days_in_month</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">maturity_date</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

  <span class="c1"># Check if the date&#39;s day is the last day of the month</span>
  <span class="n">end_month</span> <span class="o">=</span> <span class="p">(</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">days_in_month</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">end_month</span><span class="p">:</span><span class="n">day</span><span class="o">=</span><span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span><span class="n">day</span><span class="o">=</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">day</span>
  <span class="k">return</span> <span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">),</span><span class="n">end_month</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="checking-the-results-of-settle-year-mat">
<h3>Checking The Results Of settle_year_mat()<a class="headerlink" href="#checking-the-results-of-settle-year-mat" title="Link to this heading">#</a></h3>
<p>The function is tested by iterating through the index of <font color='green'>five_bonds</font>. The settlement date is the current year so no value is assigned to the year argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">maturity</span> <span class="ow">in</span> <span class="n">five_bonds</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
  <span class="n">display</span><span class="p">(</span><span class="n">settle_year_mat</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span> <span class="n">settlement</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(datetime.date(2025, 2, 28), True)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(datetime.date(2025, 7, 15), False)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(datetime.date(2025, 8, 31), True)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(datetime.date(2025, 1, 15), False)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(datetime.date(2025, 2, 28), True)
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-function-returning-the-next-and-last-coupon-date">
<h3>A Function Returning The Next And Last Coupon Date<a class="headerlink" href="#a-function-returning-the-next-and-last-coupon-date" title="Link to this heading">#</a></h3>
<p>The <font color='green'>next_last_coupon()</font> function returns the next and last coupon dates required for accrued interest calculations.  It takes arguments for the maturity date (maturity), the settlement date (settlement), and the frequency of payments (freq). Settlement and freq have default values; None and two (for semi-annual payments), respectively. If the settlement argument is None,the current date becomes the settlement date. The integer value of twelve divided by the frequency of payments (floor diviision //) is assigned to the variable <font color='green'>num_months</font>. The settlement date marks the start of the next coupon period, and the end of the period is the settlement date plus <font color='green'>relativedelta(months=num_months)</font>, adjusted if the maturity date is  the last day of the month.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">next_last_coupon_dates</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span><span class="n">settlement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>
    <span class="k">if</span> <span class="n">freq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Default to semi-annual if input is invalid</span>
    <span class="k">if</span> <span class="n">settlement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">settlement</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="n">num_months</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">//</span> <span class="n">freq</span>
</pre></div>
</div>
<p>The <font color='green'>settle_year_mat()</font> function is called, returning the bond’s maturity anniversary date in the settlement year. If that coupon date precedes or exceeds the settlement date, the next coupon date’s values are adjusted until it is greater than or  equal to the settlement date . The while control statement modifies the dates by the number of months in the coupon period.  Last day of the month is accounted for.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">coupon_date</span><span class="p">,</span> <span class="n">is_month_end</span> <span class="o">=</span> <span class="n">settle_year_mat</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span> <span class="n">settlement</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>    
    <span class="k">if</span> <span class="n">coupon_date</span> <span class="o">&lt;</span> <span class="n">settlement</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">coupon_date</span> <span class="o">&lt;</span> <span class="n">settlement</span><span class="p">:</span>
            <span class="n">coupon_date</span> <span class="o">+=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_month_end</span><span class="p">:</span>
                <span class="n">coupon_date</span> <span class="o">=</span> <span class="n">_last_day_of_month</span><span class="p">(</span><span class="n">coupon_date</span><span class="p">)</span>
    <span class="c1"># If the anniversary is too far in the future, step back</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">coupon_date</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">settlement</span><span class="p">:</span>
             <span class="n">coupon_date</span> <span class="o">-=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">is_month_end</span><span class="p">:</span>
                <span class="n">coupon_date</span> <span class="o">=</span> <span class="n">last_day_month</span><span class="p">(</span><span class="n">coupon_date</span><span class="p">)</span>
    <span class="n">next_coupon</span> <span class="o">=</span> <span class="n">coupon_date</span>
</pre></div>
</div>
<p>The last coupon date is calculated from the next coupon date. The last coupon is adjusted for month end maturity date.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">last_coupon</span> <span class="o">=</span> <span class="n">next_coupon</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>    
    <span class="k">if</span> <span class="n">is_month_end</span><span class="p">:</span>
        <span class="n">last_coupon</span> <span class="o">=</span> <span class="n">last_day_month</span><span class="p">(</span><span class="n">last_coupon</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">next_coupon</span><span class="p">,</span> <span class="n">last_coupon</span>

</pre></div>
</div>
<img src='https://docs.google.com/drawings/d/e/2PACX-1vS3qndqtXLhnQlXP8pOEQg91guBfoDoHIt3XaTBpu-ePbJaoFIEIpjcMqct8nDrS4fPaz-EXy6I9g06/pub?w=960&h=720'><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">next_last_coupon_dates</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span> <span class="n">settlement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the next and last coupon dates relative to a settlement date.</span>

<span class="sd">    Args:</span>
<span class="sd">        maturity (datetime): The maturity date of the instrument.</span>
<span class="sd">        settlement (datetime, optional): The date for which the calculation is made.</span>
<span class="sd">                                       Defaults to the current date if None.</span>
<span class="sd">        freq (int, optional): The frequency of payments per year.</span>
<span class="sd">                              Valid values: 1 (annual), 2 (semi-annual),</span>
<span class="sd">                              4 (quarterly), 12 (monthly). Defaults to 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing (next_coupon_date, last_coupon_date).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1. --- Input Validation and Setup ---</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">date</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>
    <span class="k">if</span> <span class="n">freq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Default to semi-annual if input is invalid</span>
    <span class="c1"># Normalize maturity and settlement dates to avoid time-of-day issues.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span> <span class="n">maturity</span> <span class="o">=</span> <span class="n">maturity</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settlement</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span> <span class="n">settlement</span> <span class="o">=</span> <span class="n">settlement</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">settlement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">settlement</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

    <span class="n">num_months</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">//</span> <span class="n">freq</span>
    <span class="c1"># 2. --- Determine Coupon Anniversary and Month-End Status ---</span>
    <span class="c1"># Start by finding the coupon date in the settlement year</span>
    <span class="n">coupon_date</span><span class="p">,</span> <span class="n">is_month_end</span> <span class="o">=</span> <span class="n">settle_year_mat</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span> <span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span><span class="p">)</span>
    <span class="c1"># 3. --- Find the NEXT Coupon Date ---</span>
    <span class="c1"># If the anniversary in the settlement year has already passed, find the first one after</span>
    <span class="k">if</span> <span class="n">coupon_date</span> <span class="o">&lt;</span> <span class="n">settlement</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">coupon_date</span> <span class="o">&lt;</span> <span class="n">settlement</span><span class="p">:</span>
            <span class="n">coupon_date</span> <span class="o">+=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_month_end</span><span class="p">:</span>
                <span class="n">coupon_date</span> <span class="o">=</span> <span class="n">last_day_month</span><span class="p">(</span><span class="n">coupon_date</span><span class="p">)</span>
    <span class="c1"># If the anniversary is too far in the future, step back</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">coupon_date</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">settlement</span><span class="p">:</span>
             <span class="n">coupon_date</span> <span class="o">-=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">is_month_end</span><span class="p">:</span>
                <span class="n">coupon_date</span> <span class="o">=</span> <span class="n">last_day_month</span><span class="p">(</span><span class="n">coupon_date</span><span class="p">)</span>

    <span class="n">next_coupon</span> <span class="o">=</span> <span class="n">coupon_date</span>

    <span class="c1"># 4. --- Find the LAST Coupon Date ---</span>
    <span class="c1"># The last coupon is simply one period before the next coupon</span>
    <span class="n">last_coupon</span> <span class="o">=</span> <span class="n">next_coupon</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_month_end</span><span class="p">:</span>
        <span class="n">last_coupon</span> <span class="o">=</span> <span class="n">last_day_month</span><span class="p">(</span><span class="n">last_coupon</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">next_coupon</span><span class="p">,</span> <span class="n">last_coupon</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="checking-the-results-of-next-last-coupon-dates">
<h3>Checking The Results Of next_last_coupon_dates()<a class="headerlink" href="#checking-the-results-of-next-last-coupon-dates" title="Link to this heading">#</a></h3>
<p>The function is tested by iterating through the index of <font color='green'>five_bonds</font>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settlement</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>
<span class="k">for</span> <span class="n">maturity</span> <span class="ow">in</span> <span class="n">five_bonds</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">next_last_coupon_dates</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span><span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(datetime.date(2025, 2, 28), datetime.date(2024, 8, 31))
(datetime.date(2025, 7, 15), datetime.date(2025, 1, 15))
(datetime.date(2025, 2, 28), datetime.date(2024, 8, 31))
(datetime.date(2025, 7, 15), datetime.date(2025, 1, 15))
(datetime.date(2025, 2, 28), datetime.date(2024, 8, 31))
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="application-days-between-coupon-and-payment-dates">
<h2><font color='green'>Application:Days Between Coupon And Payment Dates</font><a class="headerlink" href="#application-days-between-coupon-and-payment-dates" title="Link to this heading">#</a></h2>
<p><span style="display:block;background-color:LightGray;
    border-left: 12px solid green;
    font-family: 'Garamond', serif;
    line-height: 1.5;
    padding: 15px">
<br>
Assume a bond matures on January 15<span class="math notranslate nohighlight">\(^{th}\)</span> 2030 and the settlement date is May 1<span class="math notranslate nohighlight">\(^{st}\)</span> 2024.  Calculate the number of days since the last coupon payment and the number of days between the last and next coupon payment. see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Hints.html#calculate-days-between-coupon-payment-and-settlement-dates">Calculate Days Between Coupon Payment And Settlement Dates</a>, and check the <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Results.html#calculate-days-between-coupon-payment-and-settlement-dates">expected results here</a>.
<br>
<br>
</span></p>
<section id="id1">
<h3>Calculating Accrued Interest<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Accrued interest for Government bonds is calculated by determining the ratio of days since the last coupon payment to the total days between coupon payments. This calculation uses the settlement date, next coupon date, and last coupon date. For Corporate and other bonds, accrued interest is calculated based on a 30-day month and 360-day year.  Using the settlement date of January  21<span class="math notranslate nohighlight">\(^{st}\)</span> 2025, the diagram highlights the calculations for the five Government bonds paying a coupon on February 28<span class="math notranslate nohighlight">\(^{th}\)</span> 2025 or July 15<span class="math notranslate nohighlight">\(^{th}\)</span> 2025.
<img src='https://docs.google.com/drawings/d/e/2PACX-1vR6XvDjt0b_IiI23LnhIthZ1uMpS4dMOX9LH0gW5wMK_7DnpkaFiu1lkP3T8otpurLPU5jI9y8f18ea/pub?w=960&h=720'></p>
<p>The first line of code converts the maturity date to a datetime object at midnight. The second line of code assigns the current date at midnight to the settlement date if the settlement date is None. The maturity and settlement dates are arguments of the <font color='green'>next_last_coupon_dates()</font> function returning the next and last coupon dates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">maturity</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="n">maturity</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">maturity</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">settlement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">today</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="n">settlement</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
  <span class="n">next_date</span><span class="p">,</span><span class="n">last_date</span><span class="o">=</span><span class="n">next_last_coupon_dates</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span><span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span><span class="p">)</span>
</pre></div>
</div>
<p>For government bonds, determining the days since the last coupon payment and the interval between the last and next payment dates is a straightforward calculation. It merely involves finding the difference between the two relevant datetimes and extracting the <font color='green'>days</font> attribute from the result.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">bond_type</span><span class="o">==</span><span class="s1">&#39;Government&#39;</span><span class="p">:</span>
  <span class="n">days_between</span><span class="o">=</span><span class="p">(</span><span class="n">next_date</span><span class="o">-</span><span class="n">last_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
  <span class="n">days_since_last</span><span class="o">=</span><span class="p">(</span><span class="n">settlement</span><span class="o">-</span><span class="n">last_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
</pre></div>
</div>
<p>For non Government bonds, it is necessary to account for both the months and the days within each month that have elapsed. To simplify this calculation, a standard assumption is made: excepting February, all months are considered to have 30 days.The function <font color='green'>convention_30_360()</font> calculates days between dates with the 30/360 convention.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">convert_30_360</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
  <span class="n">d1</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span>
  <span class="n">d2</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">is_last_day_of_feb</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">end_date</span><span class="p">):</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="mi">30</span>
  <span class="k">if</span> <span class="n">d1</span> <span class="o">==</span> <span class="mi">31</span> <span class="ow">or</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">start_date</span><span class="p">):</span>
      <span class="n">d1</span> <span class="o">=</span> <span class="mi">30</span>

  <span class="k">if</span> <span class="n">d2</span> <span class="o">==</span> <span class="mi">31</span> <span class="ow">and</span> <span class="n">d1</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="mi">30</span>
  <span class="n">day_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">360</span> <span class="o">+</span> <span class="p">(</span><span class="n">m2</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="p">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">day_count_year</span><span class="p">)</span> <span class="o">*</span> <span class="mi">360</span> <span class="o">+</span> <span class="p">(</span><span class="n">next_month</span> <span class="o">-</span> <span class="n">last_month</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="p">(</span><span class="n">next_day</span> <span class="o">-</span> <span class="n">last_day</span><span class="p">)</span>
</pre></div>
</div>
<p>The differences are illustrated with the calculations of the days since and the days between.</p>
<ul class="simple">
<li><p><font size=4>Calculating  the days between January 21, 2025, and August 31, 2024, using the 30-day month convention results in 141 days. The actual number of days is 143.</font></p></li>
<li><p><font size=4>Calculating  the days between February 28, 2025, and August 31, 2024, using the 30-day month convention results in 178 days. The actual number of days is 181.</font></p></li>
</ul>
<p>The final lines of code determine the ratio of days since the last payment to the total days between payments. This ratio equals one on the coupon date, but the coupon  is paid and no accrued interest is due.  If the settlement date equals the next coupon date, accrued interest is zero, The coupon is divided by the frequency of payments (i.e., two for semi-annual payments).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">accrued_adjustment</span><span class="o">=</span><span class="n">days_since_last</span><span class="o">/</span><span class="n">days_between</span>
  <span class="k">if</span> <span class="n">accrued_adjustment</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span><span class="n">accrued_adjustment</span><span class="o">=</span><span class="mi">0</span>
  <span class="k">return</span> <span class="n">coupon</span><span class="o">/</span><span class="n">freq</span><span class="o">*</span><span class="n">accrued_adjustment</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">convert_30_360</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Calculates the number of days between two dates using the 30U/360</span>
<span class="sd">  (US Bond Basis) convention.</span>

<span class="sd">  Args:</span>
<span class="sd">      start_date: The beginning date of the period.</span>
<span class="sd">      end_date: The ending date of the period.</span>

<span class="sd">  Returns:</span>
<span class="sd">      The number of days calculated using the 30U/360 convention.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
  <span class="n">d1</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span>
  <span class="n">d2</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span>

  <span class="c1"># Helper to check if a date is the last day of February</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">is_last_day_of_feb</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

  <span class="c1"># --- Apply the 30U/360 rules ---</span>

  <span class="c1"># Rule 1: If both dates are the last day of Feb, change end_date&#39;s day to 30.</span>
  <span class="k">if</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">end_date</span><span class="p">):</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="mi">30</span>

  <span class="c1"># Rule 2: If start_date is 31 or last day of Feb, change its day to 30.</span>
  <span class="k">if</span> <span class="n">d1</span> <span class="o">==</span> <span class="mi">31</span> <span class="ow">or</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">start_date</span><span class="p">):</span>
      <span class="n">d1</span> <span class="o">=</span> <span class="mi">30</span>

  <span class="c1"># Rule 3: If end_date is 31 AND start_date&#39;s day was changed to 30, change end_date&#39;s day to 30.</span>
  <span class="k">if</span> <span class="n">d2</span> <span class="o">==</span> <span class="mi">31</span> <span class="ow">and</span> <span class="n">d1</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="mi">30</span>

  <span class="c1"># --- Perform the final calculation ---</span>
  <span class="n">day_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">360</span> <span class="o">+</span> <span class="p">(</span><span class="n">m2</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="p">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">day_count</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">accrued_interest</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span> <span class="n">coupon</span><span class="p">,</span> <span class="n">bond_type</span><span class="o">=</span><span class="s1">&#39;Government&#39;</span><span class="p">,</span> <span class="n">settlement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Returns the accrued interest for a bond.</span>

<span class="sd">  Uses Actual/Actual for Government bonds or 30/360 for other bond types.</span>
<span class="sd">  No accrued interest is calculated if settlement is on a payment date.</span>

<span class="sd">  Args:</span>
<span class="sd">      maturity (datetime): The maturity date of the bond.</span>
<span class="sd">      coupon (float): The annual coupon rate (e.g., 0.05 for 5%).</span>
<span class="sd">      bond_type (str, optional): &#39;Government&#39; or other. Defaults to &#39;Government&#39;.</span>
<span class="sd">      settlement (datetime, optional): The settlement date. Defaults to today.</span>
<span class="sd">      freq (int, optional): Coupon frequency per year. Defaults to 2.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span><span class="n">date</span>
  <span class="c1"># Normalize maturity and settlement dates to avoid time-of-day issues.</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span> <span class="n">maturity</span> <span class="o">=</span> <span class="n">maturity</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settlement</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span> <span class="n">settlement</span> <span class="o">=</span> <span class="n">settlement</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">freq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
      <span class="n">freq</span> <span class="o">=</span> <span class="mi">2</span>

  <span class="c1">#Set maturity, settlement, and coupon dates</span>
  <span class="n">maturity</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="n">maturity</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">maturity</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">settlement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">today</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="n">settlement</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
  <span class="n">next_date</span><span class="p">,</span><span class="n">last_date</span><span class="o">=</span><span class="n">next_last_coupon_dates</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span><span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span><span class="p">)</span>
  <span class="c1">#Government bonds are actual/acutal</span>
  <span class="k">if</span> <span class="n">bond_type</span> <span class="o">==</span> <span class="s1">&#39;Government&#39;</span><span class="p">:</span>
      <span class="c1"># Actual/Actual convention</span>
      <span class="n">days_since_last</span> <span class="o">=</span> <span class="p">(</span><span class="n">settlement</span> <span class="o">-</span> <span class="n">last_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
      <span class="n">days_between</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_date</span> <span class="o">-</span> <span class="n">last_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
  <span class="c1">#other bonds are 30/360</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="c1"># 30/360 convention</span>
      <span class="n">days_since_last</span> <span class="o">=</span> <span class="n">_days_30_360</span><span class="p">(</span><span class="n">last_date</span><span class="p">,</span> <span class="n">settlement</span><span class="p">)</span>
      <span class="n">days_between</span> <span class="o">=</span> <span class="n">_days_30_360</span><span class="p">(</span><span class="n">last_date</span><span class="p">,</span> <span class="n">next_date</span><span class="p">)</span>

  <span class="c1"># Avoid division by zero if coupon dates are the same</span>
  <span class="k">if</span> <span class="n">days_between</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="mf">0.0</span>

  <span class="n">accrued_ratio</span> <span class="o">=</span> <span class="n">days_since_last</span> <span class="o">/</span> <span class="n">days_between</span>

  <span class="c1"># No accrued interest on the actual coupon payment date</span>
  <span class="k">if</span> <span class="n">settlement</span> <span class="o">==</span> <span class="n">next_date</span><span class="p">:</span>
      <span class="n">accrued_ratio</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1">#Calculate coupon payment</span>
  <span class="n">periodic_coupon_payment</span> <span class="o">=</span> <span class="n">coupon</span> <span class="o">/</span> <span class="n">freq</span>

  <span class="k">return</span> <span class="n">periodic_coupon_payment</span> <span class="o">*</span> <span class="n">accrued_ratio</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-quck-look-at-pandas-apply-method">
<h3>A Quck Look At Pandas apply Method<a class="headerlink" href="#a-quck-look-at-pandas-apply-method" title="Link to this heading">#</a></h3>
<p>The <font color='green'>apply</font> avoids the need to iterate through all the values of a row or column.<span class="math notranslate nohighlight">\(^{4}\)</span>  The method has two advantages:</p>
<ol class="arabic simple">
<li><p>Because it uses the vectorization capability of Pandas, its computational efficient.</p></li>
<li><p>Coding is less complex and more easily understood,</p></li>
</ol>
<p>A row and a column example are demonstrated with the DataFrame of Chapter One, <font color='green'>rows_to_columns</font>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rows_to_columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Rates&#39;</span><span class="p">:[</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.07</span><span class="p">],</span>
                              <span class="s1">&#39;Future Values&#39;</span><span class="p">:[</span><span class="mf">1.030455</span><span class="p">,</span><span class="mf">1.05171</span><span class="p">,</span><span class="mf">1.072508</span><span class="p">],</span>
                              <span class="s1">&#39;Present Value&#39;</span><span class="p">:[</span><span class="mf">0.970446</span><span class="p">,</span><span class="mf">0.951229</span><span class="p">,</span><span class="mf">0.93294</span><span class="p">]})</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
<span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Discrete&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rows_to_column</span><span class="o">=</span> <span class="n">rows_to_columns</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Rates&#39;</span><span class="p">]),</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
<span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Log Future Values&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Future Values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(^{4}\)</span> <a class="reference external" href="https://patrickjhess.github.io/Introduction-To-Python-For-Financial-Python/An_Introduction_To_Pandas.html#the-apply-method">Pandas method apply</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create rows_to_columns DataFrame</span>
<span class="n">rows_to_columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Rates&#39;</span><span class="p">:[</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.07</span><span class="p">],</span>
                              <span class="s1">&#39;Future Values&#39;</span><span class="p">:[</span><span class="mf">1.030455</span><span class="p">,</span><span class="mf">1.05171</span><span class="p">,</span><span class="mf">1.072508</span><span class="p">],</span>
                              <span class="s1">&#39;Present Value&#39;</span><span class="p">:[</span><span class="mf">0.970446</span><span class="p">,</span><span class="mf">0.951229</span><span class="p">,</span><span class="mf">0.93294</span><span class="p">]})</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
<span class="c1"># Access the value of rows</span>
<span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Discrete&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rows_to_column</span><span class="o">=</span> <span class="n">rows_to_columns</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Rates&#39;</span><span class="p">]),</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
<span class="c1"># Access the values of column</span>
<span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Log Future Values&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Future Values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rates</th>
      <th>Future Values</th>
      <th>Present Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.03</td>
      <td>1.030455</td>
      <td>0.970446</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.05</td>
      <td>1.051710</td>
      <td>0.951229</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.07</td>
      <td>1.072508</td>
      <td>0.932940</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rates</th>
      <th>Future Values</th>
      <th>Present Value</th>
      <th>Discrete</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.03</td>
      <td>1.030455</td>
      <td>0.970446</td>
      <td>0.029559</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.05</td>
      <td>1.051710</td>
      <td>0.951229</td>
      <td>0.048790</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.07</td>
      <td>1.072508</td>
      <td>0.932940</td>
      <td>0.067659</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rates</th>
      <th>Future Values</th>
      <th>Present Value</th>
      <th>Discrete</th>
      <th>Log Future Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.03</td>
      <td>1.030455</td>
      <td>0.970446</td>
      <td>0.029559</td>
      <td>0.030000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.05</td>
      <td>1.051710</td>
      <td>0.951229</td>
      <td>0.048790</td>
      <td>0.050417</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.07</td>
      <td>1.072508</td>
      <td>0.932940</td>
      <td>0.067659</td>
      <td>0.070000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="update-bond-data-with-accrued-interest">
<h3>Update Bond Data With Accrued Interest<a class="headerlink" href="#update-bond-data-with-accrued-interest" title="Link to this heading">#</a></h3>
<p>The DataFrame <font color='green'>bond_data</font> is expanded by applying the <font color='green'>accurred_interesta</font> function to each row of <font color='green'>bond_data</font>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bond_data</span><span class="p">[</span><span class="s1">&#39;Accrued&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond_data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">accrued_interest</span><span class="p">(</span>
        <span class="n">maturity</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>      <span class="c1"># The row&#39;s index label (maturity date) is accessed via .name</span>
        <span class="n">coupon</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Coupon&#39;</span><span class="p">],</span>   <span class="c1"># Access the &#39;Coupon&#39; value from the row</span>
        <span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span>   <span class="c1"># Use the globally defined settlement date</span>
    <span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settlement</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>
<span class="c1"># Use DataFrame.apply() to create the new column</span>
<span class="c1"># &#39;axis=1&#39; tells pandas to apply the function to each row.</span>
<span class="c1"># A lambda function is used to pass the correct columns from each row to accrued_interest.</span>
<span class="n">bond_data</span><span class="p">[</span><span class="s1">&#39;Accrued&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond_data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">accrued_interest</span><span class="p">(</span>
        <span class="n">maturity</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>      <span class="c1"># The row&#39;s index label (maturity date) is accessed via .name</span>
        <span class="n">coupon</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Coupon&#39;</span><span class="p">],</span>   <span class="c1"># Access the &#39;Coupon&#39; value from the row</span>
        <span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span>   <span class="c1"># Use the globally defined settlement date</span>
    <span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">bond_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
      <th>Coupon</th>
      <th>Price Bid</th>
      <th>Price Ask</th>
      <th>Bid Size</th>
      <th>Ask Size</th>
      <th>Accrued</th>
    </tr>
    <tr>
      <th>Maturity Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2025-01-28</th>
      <td>UNITED STATES TREAS BILLS ZERO CPN       0.000...</td>
      <td>0.000</td>
      <td>99.929</td>
      <td>99.930</td>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2025-01-30</th>
      <td>UNITED STATES TREAS BILLS ZERO CPN       0.000...</td>
      <td>0.000</td>
      <td>99.906</td>
      <td>99.907</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER U-2025          1.3750...</td>
      <td>1.375</td>
      <td>99.921</td>
      <td>99.934</td>
      <td>60000.0</td>
      <td>60000.0</td>
      <td>0.650136</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER AW-2025         4.1250...</td>
      <td>4.125</td>
      <td>99.988</td>
      <td>99.997</td>
      <td>60000.0</td>
      <td>60000.0</td>
      <td>1.950408</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER G-2025          2.5000...</td>
      <td>2.500</td>
      <td>99.953</td>
      <td>99.965</td>
      <td>60000.0</td>
      <td>60000.0</td>
      <td>1.182065</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2029-11-30</th>
      <td>UNITED STATES TREAS SER AG-2029         4.1250...</td>
      <td>4.125</td>
      <td>98.910</td>
      <td>98.914</td>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>0.589286</td>
    </tr>
    <tr>
      <th>2029-11-30</th>
      <td>UNITED STATES TREAS SER S-2029          3.8750...</td>
      <td>3.875</td>
      <td>97.763</td>
      <td>97.782</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>0.553571</td>
    </tr>
    <tr>
      <th>2029-12-31</th>
      <td>UNITED STATES TREAS SER T-2029          3.8750...</td>
      <td>3.875</td>
      <td>97.734</td>
      <td>97.738</td>
      <td>65000.0</td>
      <td>65000.0</td>
      <td>0.224793</td>
    </tr>
    <tr>
      <th>2029-12-31</th>
      <td>UNITED STATES TREAS SER AH-2029         4.3750...</td>
      <td>4.375</td>
      <td>99.988</td>
      <td>99.989</td>
      <td>7000.0</td>
      <td>7000.0</td>
      <td>0.253798</td>
    </tr>
    <tr>
      <th>2030-01-31</th>
      <td>UNITED STATES TREAS SER G-2030          3.5000...</td>
      <td>3.500</td>
      <td>95.994</td>
      <td>96.011</td>
      <td>16000.0</td>
      <td>16000.0</td>
      <td>1.654891</td>
    </tr>
  </tbody>
</table>
<p>304 rows × 7 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="application-calculate-a-transaction-price">
<h2><font color='green'>Application:Calculate A Transaction Price</font><a class="headerlink" href="#application-calculate-a-transaction-price" title="Link to this heading">#</a></h2>
<div style="background-color:LightGray;
    border-left: 12px solid green;
    font-family: 'Garamond', serif;
    font-size: 17px;
    line-height: 1.5;
    padding: 15px">
<br>
<p>Assume a bond matures on January 15<span class="math notranslate nohighlight">\(^{th}\)</span> 2030 and the settlement date is May 1<span class="math notranslate nohighlight">\(^{st}\)</span> 2024. The bond’s clean quoted price is $95 and the coupon is 5.0. see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Hints.html#calculate-a-transaction-price">Chapter Two Hints:Calculate A Transaction Price</a>, and check the <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Results.html#calculate-a-transaction-price">expected results here</a>.</p>
<br>
</div>
<section id="creating-the-workbook">
<h3>Creating The Workbook<a class="headerlink" href="#creating-the-workbook" title="Link to this heading">#</a></h3>
<p>The <font color='green'>create_workbook</font> function transforms the bond_data DataFrame into an Excel workbook. It takes the sheet name, DataFrame name, and the dictionary <font color='green'>save_config</font>  as arguments. The sheet and DataFrame names are required, while save_config defaults to an empty dictionary. When <font color='green'>save_config</font> is not specified, the workbook is created in the current working directory of the notebook.</p>
<p>Note: The working directory for a Jupyter notebook is its current folder. For a Colab notebook, the location is ‘contents’ and is only available during runtime.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">save_config</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="s1">&#39;Basic Concepts Of Fixed Income&#39;</span><span class="p">,</span>
                 <span class="n">chapter</span><span class="o">=</span><span class="s1">&#39;Accrued Interest&#39;</span><span class="p">,</span>
                 <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;Accrued Interest.xlsx&#39;</span><span class="p">)</span>
<span class="n">create_workbook</span><span class="p">(</span><span class="s1">&#39;Basic Bond Data&#39;</span><span class="p">,</span><span class="n">bond_data</span><span class="p">,</span><span class="n">save_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">StdinNotImplementedError</span><span class="g g-Whitespace">                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_20574</span><span class="o">/</span><span class="mf">4099785922.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>                  <span class="n">chapter</span><span class="o">=</span><span class="s1">&#39;Accrued Interest&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                  <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;Accrued Interest.xlsx&#39;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">create_workbook</span><span class="p">(</span><span class="s1">&#39;Basic Bond Data&#39;</span><span class="p">,</span><span class="n">bond_data</span><span class="p">,</span><span class="n">save_config</span><span class="p">)</span>

<span class="nn">&lt;string&gt;</span> in <span class="ni">create_workbook</span><span class="nt">(sheet_name, df, save_config)</span>

<span class="nn">&lt;string&gt;</span> in <span class="ni">save_results</span><span class="nt">(save_config)</span>

<span class="nn">~/anaconda3/lib/python3.9/site-packages/ipykernel/kernelbase.py</span> in <span class="ni">raw_input</span><span class="nt">(self, prompt)</span>
<span class="g g-Whitespace">   </span><span class="mi">1272</span>         <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_stdin</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1273</span>             <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;raw_input was called, but this frontend does not support input requests.&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1274</span>             <span class="k">raise</span> <span class="n">StdinNotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1275</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_request</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1276</span>             <span class="nb">str</span><span class="p">(</span><span class="n">prompt</span><span class="p">),</span>

<span class="ne">StdinNotImplementedError</span>: raw_input was called, but this frontend does not support input requests.
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-default-path">
<h3>The Default Path<a class="headerlink" href="#the-default-path" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parent</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">subfolder</span><span class="o">=</span><span class="n">parent_folder_subfolder</span><span class="p">()</span>
<span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Fidelity Data&#39;</span>
<span class="n">create_workbook</span><span class="p">(</span><span class="n">sheet_name</span><span class="p">,</span><span class="n">bond_data</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="application-create-an-excel-workbook">
<h2><font color='green'>Application:Create An Excel Workbook</font><a class="headerlink" href="#application-create-an-excel-workbook" title="Link to this heading">#</a></h2>
<div style="background-color:LightGray;
    border-left: 12px solid green;
    font-family: 'Garamond', serif;
    font-size: 17px;
    line-height: 1.5;
    padding: 15px">
<br>
<p>Use the first ten rows of bond_data to create the workbook ‘Test Data’ and save it to the worksheet ‘Ten Rows Of Data’ see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Hints.html#create-a-workbook">Chapter Two Hints: Create A Workbook</a>, and check the <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Results.html#create-a-workbook">expected results here</a>.</p>
<br>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="chapter-exercise">
<h1><span style="text-align: left; color:green; font-family: 'Franklin Gothic Medium', sans-serif; margin-top: 1.0em; margin-bottom: 0em; font-style: italic;">Chapter Exercise</span><a class="headerlink" href="#chapter-exercise" title="Link to this heading">#</a></h1>
<p><span style="text-align: left; color:green; font-family: 'Franklin Gothic Medium', sans-serif; margin-top: 0; margin-bottom: 0.5em; font-style: italic;"><big><font color='black'>Create A Workbook With Accrued Interest For 100 Bonds</big></font></span></p>
<p><span style="display:block;
    border-left: 12px solid green;
    font-family: 'Garamond', serif;
    line-height: 1.5;
    padding: 15px">
<big>Using Download bond_jan_21_2025.xlsx For The Exercoise</big><br></span>
<span style="display:block;
    border-left: 12px solid green;
    font-family: 'Garamond', serif;
    line-height: 2;">
<br><big>          1. For the first 100 rows of the workbook calculate the accrued interest and save it in a new DataFrame.<br><br>          2. Save the new DataFrame as an Excel Workbook..</big><br></span>
<span style="display:block;
    border-left: 12px solid green;
    font-family: 'Garamond', serif;
    line-height: 1.5;
    padding: 15px">
<br><big>For hints, see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_One_Hints.html#chapter-one-exercise">Chapter One Hints</a>. For expected results, see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_One_Results.html#chapter-one-exercise">Chapter One Expected Results</a>.</big></p>
</span></section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "PatrickJHess/Vol-3-Chap-2-Chap-3",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Dealing_With_Dates.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Manipulating Dates</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Calculating Accrued Interest</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-notebook">Preparing The Notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-libraries-modules-and-functions">Importing Libraries, Modules, And Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-a-custom-module-and-importing-functions">Adding A Custom Module And Importing Functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-the-dataframe-bond-data">Creating The DataFrame bond_data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#illustrating-accrued-interest-with-five-unique-maturity-dates">Illustrating Accrued Interest With Five Unique Maturity Dates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-access-bonds-with-specific-characteristics"><font color="green">Application:Access Bonds With Specific Characteristics</font></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determining-the-next-coupon-date">Determining The Next Coupon Date</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-if-settlement-or-maturity-date-is-month-end">Determine If Settlement Or Maturity Date Is Month End</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#last-day-month-function">last_day_month() Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-next-coupon-period">The Next Coupon Period</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-function-calculating-the-settlement-year-maturity-month-and-day">A Function Calculating The Settlement Year, Maturity Month, And Day</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-the-results-of-settle-year-mat">Checking The Results Of settle_year_mat()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-function-returning-the-next-and-last-coupon-date">A Function Returning The Next And Last Coupon Date</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-the-results-of-next-last-coupon-dates">Checking The Results Of next_last_coupon_dates()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-days-between-coupon-and-payment-dates"><font color="green">Application:Days Between Coupon And Payment Dates</font></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Calculating Accrued Interest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quck-look-at-pandas-apply-method">A Quck Look At Pandas apply Method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update-bond-data-with-accrued-interest">Update Bond Data With Accrued Interest</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-calculate-a-transaction-price"><font color="green">Application:Calculate A Transaction Price</font></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-the-workbook">Creating The Workbook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-default-path">The Default Path</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-create-an-excel-workbook"><font color="green">Application:Create An Excel Workbook</font></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-exercise"><span style="text-align: left; color:green; font-family: 'Franklin Gothic Medium', sans-serif; margin-top: 1.0em; margin-bottom: 0em; font-style: italic;">Chapter Exercise</span></a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Financial Python
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>