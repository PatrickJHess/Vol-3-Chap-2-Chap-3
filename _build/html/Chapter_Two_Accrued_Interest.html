
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Calculating Accrued Interest &#8212; Basic Bond Concepts of Fixed Icome: Accrued Interest and Bond Payment Data</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter_Two_Accrued_Interest';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Updating Quoted Bond Prices with Accrued Interest" href="Chapter_Two_Summary.html" />
    <link rel="prev" title="Manipulating Dates" href="Dealing_With_Dates.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Basic Bond Concepts of Fixed Icome: Accrued Interest and Bond Payment Data</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Financial Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Interacting%20With%20Jupyter%20Books.html">Working with Jupyter Books</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Concepts of Fixed Income: Chapter Two</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="Chapter_Two_Highlights.html">Accrued Interest</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Machanics_Of_Bond_Pricces.html">The Mechanics of Bond Pricing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Dealing_With_Dates.html">Manipulating Dates</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Calculating Accrued Interest</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter_Two_Summary.html">Updating Quoted Bond Prices with Accrued Interest</a></li>
<li class="toctree-l2"><a class="reference internal" href="imported_functions_Two.html">Function Imported by Chapter Two.</a></li>
</ul><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Concepts of Fixed Income: Chapter Three</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="Chapter_Three_Highlights.html">Bond Payment Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Actual_Payment_Dates.html">Actual Versus Scheduled Payment Dates</a></li>
<li class="toctree-l2"><a class="reference internal" href="Non_Settlement_Days.html">Accounting for Non-Settlement Days: Holidays, Weekends, and Good Friday</a></li>
<li class="toctree-l2"><a class="reference internal" href="Bond_Pay_Dates.html">Calculating Bond Payment Dates and Amounts</a></li>

<li class="toctree-l2"><a class="reference internal" href="Chapter_Three_Summary.html">Calculating Actual Payment Dates and Amounts</a></li>
<li class="toctree-l2"><a class="reference internal" href="imported_functions_Three.html">Function Imported by Chapter Three.</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Summarizing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Transaction_Prices_Paayment_Data.html">Getting Bomd Transaction Prices and Actual Payment Dates and Amounts</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/PatrickJHess/Vol-3-Chap-2-Chap-3/master?urlpath=tree/Chapter_Two_Accrued_Interest.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/PatrickJHess/Vol-3-Chap-2-Chap-3/blob/master/Chapter_Two_Accrued_Interest.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>



<a href="https://github.com/PatrickJHess/Vol-3-Chap-2-Chap-3/issues/new?title=Issue%20on%20page%20%2FChapter_Two_Accrued_Interest.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button"
   title="Open an issue"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Chapter_Two_Accrued_Interest.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Calculating Accrued Interest</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-notebook">Preparing the notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-libraries-modules-and-functions">Importing libraries, modules, And functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-a-custom-module-and-importing-functions">Adding a custom module and importing functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-the-dataframe-bond-data">Creating the DataFrame bond_data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validating-dates-and-converting-datetime-to-date">Validating dates and converting <font color="green">datetime</font> to <font color="green">date</font>.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#illustrating-accrued-interest-with-five-unique-maturity-dates">Illustrating accrued interest with five unique maturity dates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-access-bonds-with-specific-characteristics"><font color="green">Application Access bonds with specific characteristics</font></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scheduled-payment-dates">Scheduled payment dates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-schedule-pay-dates-function">The <font color="green">schedule_pay_dates</font> function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-next-and-previous-scheduled-payment-dates">The next and previous scheduled payment dates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-calculate-days-for-accrued-interest"><font color="green">Application: Calculate days for accrued interest</font></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Calculating accrued interest</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-accrued-interest-function">The accrued_interest function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-accrued-interest-for-five-bonds-dataframe">Calculating accrued interest for <font color="green">five_bonds</font> DataFrame</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-apply-method-to-add-accrured-interest-to-the-bond-data-304-bonds-dataframe">Using the <font color="green">apply</font> method to add accrured interest to the <font color="green">bond_data</font> (304 bonds) DataFrame.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-bond-data-with-accrued-interest">Update <font color="green">bond_data</font> with accrued interest</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-calculate-a-transaction-price"><font color="green">Application: Calculate a transaction price</font></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-the-workbook">Creating the workbook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-create-an-excel-workbook"><font color="green">Application: Create an Excel workbook</font></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-exercise"><span style="text-align: left; color:green; font-family: 'Franklin Gothic Medium', sans-serif; margin-top: 1.0em; margin-bottom: 0em; font-style: italic;">Chapter Exercise</span></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="calculating-accrued-interest">
<h1>Calculating Accrued Interest<a class="headerlink" href="#calculating-accrued-interest" title="Link to this heading">#</a></h1>
<section id="preparing-the-notebook">
<h2>Preparing the notebook<a class="headerlink" href="#preparing-the-notebook" title="Link to this heading">#</a></h2>
<section id="importing-libraries-modules-and-functions">
<h3>Importing libraries, modules, And functions<a class="headerlink" href="#importing-libraries-modules-and-functions" title="Link to this heading">#</a></h3>
<p>As in Chapter One of the volume, modules that are included in the standard Python library are imported. When necessary, other modules or libraries are installed before they are imported.<span class="math notranslate nohighlight">\(^{1}\)</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import os
import sys
import requests
from datetime import , date
from types import ModuleType
import calendar

try:
    from IPython.display import Markdown, display
except:
    !pip -q install IPython
    from IPython.display import Markdown, display

try:
    import numpy as np
except:
    !pip -q install numpy
    import numpy as np

try:
    import pandas as pd
except:
    !pip -q install pandas
    import pandas as pd

try:
    from dateutil.relativedelta import relativedelta
except:
    !pip -q install python-dateutil
    from dateutil.relativedelta import relativedelta

</pre></div>
</div>
<hr class="docutils" />
<p><span class="math notranslate nohighlight">\(^{1}\)</span><a href='https://patrickjhess.github.io/Introduction-To-Python-For-Financial-Python/Control_Statements.html#the-try-and-except'>try and except statements</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import OS to interact with local computer operating system</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModuleType</span>
<span class="c1"># Import the datetime and date class from the datetime module for working with dates.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span>
<span class="c1"># Last calendar day of the month and day of the week for first day</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">display</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>-q<span class="w"> </span>install<span class="w"> </span>IPython
    <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">display</span>

<span class="c1"># Import the numpy library for data manipulation and analysis, aliased as np</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>-q<span class="w"> </span>install<span class="w"> </span>numpy
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="c1"># Import the pandas library for data manipulation and analysis, aliased as pd.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>-q<span class="w"> </span>install<span class="w"> </span>pandas
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Import the relativedelta class from dateutil for advanced date calculations.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>-q<span class="w"> </span>install<span class="w"> </span>python-dateutil
    <span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="adding-a-custom-module-and-importing-functions">
<h3>Adding a custom module and importing functions<a class="headerlink" href="#adding-a-custom-module-and-importing-functions" title="Link to this heading">#</a></h3>
<p>Like Chapter One the custom module <font color='green'>module_basic_concepts_fixed_income</font> custom module  is accessed from Dropbox and named <font color='green'>basic_concepts_fixed_income</font>.  As a reminder, the module is accessible in the notebook’s memory, but is not added to a drive.  One function, <font color='green'>create_workbook</font>, is added to the notebook. Any functions that are included in the module are available to <font color='green'>create_workbook</font>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">basic_income_module</span><span class="p">(</span><span class="n">create_workbook</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><font color='green'>create_workbook()</font> <a class="reference external" href="https://patrickjhess.github.io/Imported-Functions/create_workbook.html#create-workbook-is-a-helper-function-that-creates-excel-workbooks-from-dataframes-created-by-financial-python">view here</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the URL of the Python module to be downloaded from Dropbox.</span>
<span class="c1"># The &#39;dl=1&#39; parameter in the URL forces a direct download of the file content.</span>
<span class="n">url</span><span class="o">=</span> <span class="s1">&#39;https://www.dropbox.com/scl/fi/4y5hjxlfphh1ngvbgo77q/</span><span class="se">\</span>
<span class="s1">module_-basic_concepts_fixed_income.py?rlkey=6oxi7mgka42veaat79hcv8boz&amp;st=87sztshr&amp;dl=1&#39;</span>
<span class="n">module_name</span><span class="o">=</span><span class="s1">&#39;basic_concepts_fixed_income&#39;</span>
<span class="c1"># Send an HTTP GET request to the URL and store the server&#39;s response.</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="c1"># Raise an exception for bad status codes (like 404 Not Found)</span>
  <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
  <span class="n">module</span><span class="o">=</span> <span class="n">ModuleType</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
  <span class="c1">#Code contained in response.text executed</span>
  <span class="n">exec</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
  <span class="c1"># Module added to sys</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span><span class="o">=</span><span class="n">module</span>
<span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Error: Could not fetch module from URL. </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Error: Failed to execute or import the module. </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Now that &#39;basic_concepts_fixed_income&#39; exists in the notebook, import the specific functions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">basic_concepts_fixed_income</span><span class="w"> </span><span class="kn">import</span><span class="p">(</span><span class="n">create_workbook</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="creating-the-dataframe-bond-data">
<h2>Creating the DataFrame bond_data<a class="headerlink" href="#creating-the-dataframe-bond-data" title="Link to this heading">#</a></h2>
<p>US Treasury notes and bonds data, for settlement on January 21, 2025,  obtained from Fidelity, an Excel workbook, is downloaded from DropBox using the Panda’s <font color='green'>read_excel()</font> method.<span class="math notranslate nohighlight">\(^{2}\)</span></p>
<p>Three arguments are passed to the method.</p>
<ol class="arabic simple">
<li><p>The URL address (<font color='green'>url</font>) is required.</p></li>
<li><p>Assigning the index column is optional. The maturity dates, located in the first column, are set as the index of the DataFrame  (<font color='green'>index_col=’Maturity Date’</font>).</p></li>
<li><p>The worksheet name defaults to the first worksheet. The worksheet’s name, ‘Fidelity Data’, is the assigned sheet (<font color='green'>sheet_name=’Fidelity Data’</font>)</p></li>
</ol>
<p>The <font color='green'>display()</font>  function shows the first and last five rows confirming that data has been successfully accessed.</p>
<hr class="docutils" />
<p><span class="math notranslate nohighlight">\(^{2}\)</span> <a href='https://patrickjhess.github.io/Introduction-To-Python-For-Financial-Python/An_Introduction_To_Pandas.html#dataframes-csv-and-excel-files'>Pandas method read_excel</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#The full file path.</span>
<span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://www.dropbox.com/scl/fi/lgnaj41bt8o9sv5a63rr1/</span><span class="se">\</span>
<span class="s1">bond_data_jan21_2025.xlsx?rlkey=twjzkcqo0g2ahvot78518ti4x&amp;st=ihc5feog&amp;dl=1&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting to load data from:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1">#Load the data from Excel, using the first column as the index.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">bond_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Maturity Date&#39;</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Fidelity Data&#39;</span><span class="p">)</span>

    <span class="c1"># Display the first and last 5 rows of the loaded DataFrame to verify it worked..</span>
    <span class="n">display</span><span class="p">(</span><span class="n">bond_data</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: File not found.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check that the &#39;folder&#39; and &#39;file&#39; variables are spelled correctly&#39;</span><span class="se">\</span>
<span class="s2">&#39; and that the file exists in that location.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Attempting to load data from:
 https://www.dropbox.com/scl/fi/lgnaj41bt8o9sv5a63rr1/bond_data_jan21_2025.xlsx?rlkey=twjzkcqo0g2ahvot78518ti4x&amp;st=ihc5feog&amp;dl=1
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
      <th>Coupon</th>
      <th>Price Bid</th>
      <th>Price Ask</th>
      <th>Bid Size</th>
      <th>Ask Size</th>
    </tr>
    <tr>
      <th>Maturity Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2025-01-28</th>
      <td>UNITED STATES TREAS BILLS ZERO CPN       0.000...</td>
      <td>0.000</td>
      <td>99.929</td>
      <td>99.930</td>
      <td>100000.0</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>2025-01-30</th>
      <td>UNITED STATES TREAS BILLS ZERO CPN       0.000...</td>
      <td>0.000</td>
      <td>99.906</td>
      <td>99.907</td>
      <td>40000.0</td>
      <td>40000.0</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER U-2025          1.3750...</td>
      <td>1.375</td>
      <td>99.921</td>
      <td>99.934</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER AW-2025         4.1250...</td>
      <td>4.125</td>
      <td>99.988</td>
      <td>99.997</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER G-2025          2.5000...</td>
      <td>2.500</td>
      <td>99.953</td>
      <td>99.965</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2029-11-30</th>
      <td>UNITED STATES TREAS SER AG-2029         4.1250...</td>
      <td>4.125</td>
      <td>98.910</td>
      <td>98.914</td>
      <td>100000.0</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>2029-11-30</th>
      <td>UNITED STATES TREAS SER S-2029          3.8750...</td>
      <td>3.875</td>
      <td>97.763</td>
      <td>97.782</td>
      <td>40000.0</td>
      <td>40000.0</td>
    </tr>
    <tr>
      <th>2029-12-31</th>
      <td>UNITED STATES TREAS SER T-2029          3.8750...</td>
      <td>3.875</td>
      <td>97.734</td>
      <td>97.738</td>
      <td>65000.0</td>
      <td>65000.0</td>
    </tr>
    <tr>
      <th>2029-12-31</th>
      <td>UNITED STATES TREAS SER AH-2029         4.3750...</td>
      <td>4.375</td>
      <td>99.988</td>
      <td>99.989</td>
      <td>7000.0</td>
      <td>7000.0</td>
    </tr>
    <tr>
      <th>2030-01-31</th>
      <td>UNITED STATES TREAS SER G-2030          3.5000...</td>
      <td>3.500</td>
      <td>95.994</td>
      <td>96.011</td>
      <td>16000.0</td>
      <td>16000.0</td>
    </tr>
  </tbody>
</table>
<p>304 rows × 6 columns</p>
</div></div></div>
</div>
</section>
<section id="validating-dates-and-converting-datetime-to-date">
<h2>Validating dates and converting <font color='green'>datetime</font> to <font color='green'>date</font>.<a class="headerlink" href="#validating-dates-and-converting-datetime-to-date" title="Link to this heading">#</a></h2>
<p>In the <em>Manipulating Dates</em> section, we noted that the datetime library creates two distinct, but related, object types. For calculations like accrued interest or bond payment dates, <font color='green'>date</font> objects are preferable to  <font color='green'>datetime</font> objects because they only contain the necessary year, month, and day attributes.</p>
<p><font color='green'>datetime</font> objects include unnecessary time attributes (hour, second, microsecond) that can complicate comparisons between two dates with the same year, month, and day. To prevent such issues, all <font color='green'>datetime</font> objects are converted to <font color='green'>date</font> objects.</p>
<p>The <font color='green'>validate_date</font> function ensures its argument is either a  <font color='green'>datetime</font> or  <font color='green'>date</font>, raising an error if it is neither. It also handles the conversion of any  <font color='green'>datetime</font> instance to a  <font color='green'>date</font> object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">validate_date</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Validates that input is a date/datetime and returns a date object.</span>

<span class="sd">  This helper function checks if the input is either a</span>
<span class="sd">  datetime.datetime or datetime.date object. If it&#39;s a</span>
<span class="sd">  datetime.datetime, it converts it to a datetime.date.</span>
<span class="sd">  It always returns a datetime.date object.</span>

<span class="sd">  Args:</span>
<span class="sd">    datetime_obj (datetime.date or datetime.datetime):</span>
<span class="sd">      The input to validate and convert.</span>

<span class="sd">  Returns:</span>
<span class="sd">    datetime.date: The resulting date object.</span>

<span class="sd">  Raises:</span>
<span class="sd">    TypeError: If the input is not a datetime.date or</span>
<span class="sd">               datetime.datetime object.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">date</span>

  <span class="c1">#Validation ---</span>

  <span class="c1"># Check if the object is of the expected type (date or datetime)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">)):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a datetime or date object.&quot;</span><span class="p">)</span>

  <span class="c1">#Standardization ---</span>

  <span class="c1"># If the object is a datetime, convert it to a date.</span>
  <span class="c1"># This makes the return type consistent.</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
    <span class="n">datetime_obj</span> <span class="o">=</span> <span class="n">datetime_obj</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

  <span class="c1"># Return the object, which is now guaranteed to be a date object.</span>
  <span class="k">return</span> <span class="n">datetime_obj</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="illustrating-accrued-interest-with-five-unique-maturity-dates">
<h2>Illustrating accrued interest with five unique maturity dates<a class="headerlink" href="#illustrating-accrued-interest-with-five-unique-maturity-dates" title="Link to this heading">#</a></h2>
<p>The <font color='green'>loc</font> attribute is used to select bonds based on the five maturity dates. Because the <font color='green'>sample_bonds</font> DataFrame contains multiple bonds with the same maturity date, the Pandas <font color='green'>duplicated</font> method is employed to obtain five unique bonds, each corresponding to a distinct maturity date. When <font color='green'>keep</font> is set to ‘first’, <code class="docutils literal notranslate"><span class="pre">True</span></code> is assigned to the first occurrence of a duplicated value and <code class="docutils literal notranslate"><span class="pre">False</span></code> to subsequent duplicates. Consequently, <font color='green'>loc</font> only returns the rows where <font color='green'>duplicated()</font> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, yielding the five bonds with unique maturity dates.<span class="math notranslate nohighlight">\(^{3}\)</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maturity_dates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2026</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2028</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">sample_bonds</span><span class="o">=</span><span class="n">bond_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">maturity_dates</span><span class="p">]</span>
<span class="n">unique_bond</span><span class="o">=</span> <span class="o">~</span><span class="n">all_sample_bonds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">unique_bonds</span><span class="p">)</span>
<span class="n">five_bonds</span><span class="o">=</span><span class="n">sample_bonds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unique_bonds</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">five_bonds</span><span class="p">)</span>


</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(^{3}\)</span> <a href='https://patrickjhess.github.io/Introduction-To-Python-For-Financial-Python/An_Introduction_To_Pandas.html#pandas-duplicated-method'>The Pandas Method duplicated</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Define a specific list of upcoming bond maturity dates to analyze ---</span>
<span class="c1"># These dates were selected for a targeted review of bonds maturing in</span>
<span class="c1"># late 2025 and early 2026.</span>
<span class="n">maturity_dates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2026</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
    <span class="n">date</span><span class="p">(</span><span class="mi">2028</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># Use the .loc indexer to perform a label-based lookup.</span>
<span class="c1"># This retrieves all rows where the DataFrame&#39;s index exactly matches the dates in the list.</span>
<span class="n">sample_bonds</span> <span class="o">=</span> <span class="n">bond_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">maturity_dates</span><span class="p">]</span>
<span class="c1"># ~ negates the value of duplicated..the maturity is unique</span>
<span class="c1"># keep the first instance that is not a duplicate...a unique index is unmodified</span>
<span class="n">unique_bonds</span><span class="o">=</span> <span class="o">~</span><span class="n">sample_bonds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
<span class="c1"># display the value of the series unique_bonds</span>
<span class="n">display</span><span class="p">(</span><span class="n">unique_bonds</span><span class="p">)</span>
<span class="n">five_bonds</span><span class="o">=</span><span class="n">sample_bonds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unique_bonds</span><span class="p">]</span>

<span class="c1"># Render the resulting &#39;five_bonds&#39; DataFrame as a formatted table in the output.</span>
<span class="n">display</span><span class="p">(</span><span class="n">five_bonds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ True, False, False,  True,  True, False, False,  True,  True,
       False])
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
      <th>Coupon</th>
      <th>Price Bid</th>
      <th>Price Ask</th>
      <th>Bid Size</th>
      <th>Ask Size</th>
    </tr>
    <tr>
      <th>Maturity Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2025-02-28</th>
      <td>UNITED STATES TREAS NOTE 1.12500% 02/28/2025</td>
      <td>1.125</td>
      <td>99.671</td>
      <td>99.684</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>2025-07-15</th>
      <td>UNITED STATES TREAS SER AQ-2025         3.0000...</td>
      <td>3.000</td>
      <td>99.394</td>
      <td>99.406</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>2025-08-31</th>
      <td>UNITED STATES TREAS SER AC-2025         0.2500...</td>
      <td>0.250</td>
      <td>97.605</td>
      <td>97.610</td>
      <td>60000.0</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>2026-01-15</th>
      <td>UNITED STATES TREAS SER AJ-2026         3.8750...</td>
      <td>3.875</td>
      <td>99.671</td>
      <td>99.688</td>
      <td>40000.0</td>
      <td>40000.0</td>
    </tr>
    <tr>
      <th>2028-02-29</th>
      <td>UNITED STATES TREAS SER V-2028          4.0000...</td>
      <td>4.000</td>
      <td>99.099</td>
      <td>99.118</td>
      <td>40000.0</td>
      <td>40000.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="application-access-bonds-with-specific-characteristics">
<h2><font color='green'>Application Access bonds with specific characteristics</font><a class="headerlink" href="#application-access-bonds-with-specific-characteristics" title="Link to this heading">#</a></h2>
<div style="
    border-left: 12px solid green;
    line-height: 1.5;
    padding: 15px">
<br>
<p>Access the bonds that mature at the end of April and October 2025. Create a DataFrame of the bonds with a coupon greater than 3.5. For hints, see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Hints.html#access-bonds-with-specific-characteristics">Chapter Two Hints:Access Bonds With Specific Characteristics</a>, and check the <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Results.html#access-bonds-with-specific-characteristics">expected results here</a>.</p>
<br>
</div>
</section>
<section id="scheduled-payment-dates">
<h2>Scheduled payment dates<a class="headerlink" href="#scheduled-payment-dates" title="Link to this heading">#</a></h2>
<p>To calculate a bond’s accrued interest, the scheduled payment dates must be known. Because the bond’s maturity date is a scheduled payment date, all other scheduled payment dates can be determined by working backward from the maturity date, using the time interval between payments. The <font color='green'>scheduled_pay_dates</font> function performs this calculation.</p>
<p>The function uses a <font color='green'>while</font> loop, starting at the maturity date and workinging backward toward the settlement date. In each iteration, a scheduled <font color='green'>pay_date</font> is appended to the dates <font color='green'>list</font>.</p>
<p>The time between scheduled payments is represented by <font color='green'>num_months</font> (e.g., six for a semi-annual bond). The <font color='green'>pay_date</font> value  is reduced by this interval in each iteration using  <font color='green'>relativedelta</font>. The variable <font color='green'>is_month_end</font> is set using <font color='green'>calendar.monthrange</font> (as demonstrated in the <em>Manipulating Dates</em> notebook) to determine if the maturity is a month-end date. If the maturity is a month-end, the corresponding iteration’s <font color='green'>pay_date</font> is assigned the last day of its month.</p>
<p>The list of dates is initially generated in reverse order because the calculation starts from the maturity date. To correct this sequence, the list is then reversed by using the <font color='green'>[::-1]</font> slice notation (starting at the end and moving backwards).<span class="math notranslate nohighlight">\(^{4}\)</span></p>
<p>The following example demonstrates the function for a settlement date of January 21, 2025, and a maturity date of February 28, 2030:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">settlement</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">maturity</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2030</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pay_date</span> <span class="o">=</span> <span class="n">maturity</span>
<span class="n">is_month_end</span> <span class="o">=</span> <span class="n">maturity</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">maturity</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">freq</span><span class="o">=</span><span class="mi">2</span>
<span class="n">num_months</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">12</span><span class="o">/</span><span class="n">freq</span><span class="p">)</span>
<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pay_date</span> <span class="o">=</span> <span class="n">maturity</span>

<span class="c1">#Loop backward from the maturity date</span>

<span class="k">while</span> <span class="n">pay_date</span> <span class="o">&gt;</span> <span class="n">settlement</span><span class="p">:</span>
  <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pay_date</span><span class="p">)</span>
      
  <span class="c1"># Decrement by the frequency</span>
  <span class="n">pay_date</span> <span class="o">-=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>

  <span class="c1"># Handle Month End Logic</span>
  <span class="k">if</span> <span class="n">is_month_end</span><span class="p">:</span>
    <span class="n">last_day</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">pay_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">pay_date</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pay_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="n">pay_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">pay_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">last_day</span><span class="p">)</span>
<span class="n">dates</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(^{4}\)</span> see <a class="reference external" href="https://">see A Quick Introduction To Lists</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settlement</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">maturity</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2030</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pay_date</span> <span class="o">=</span> <span class="n">maturity</span>
<span class="n">is_month_end</span> <span class="o">=</span> <span class="n">maturity</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">maturity</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">freq</span><span class="o">=</span><span class="mi">2</span>
<span class="n">num_months</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">12</span><span class="o">/</span><span class="n">freq</span><span class="p">)</span>
<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pay_date</span> <span class="o">=</span> <span class="n">maturity</span>

<span class="c1">#Loop backward from the maturity date</span>

<span class="k">while</span> <span class="n">pay_date</span> <span class="o">&gt;</span> <span class="n">settlement</span><span class="p">:</span>
  <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pay_date</span><span class="p">)</span>

  <span class="c1"># Decrement by the frequency</span>
  <span class="n">pay_date</span> <span class="o">-=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>

  <span class="c1"># Handle Month End Logic</span>
  <span class="k">if</span> <span class="n">is_month_end</span><span class="p">:</span>
    <span class="n">last_day</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">pay_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">pay_date</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pay_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="n">pay_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">pay_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">last_day</span><span class="p">)</span>
<span class="n">dates</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[datetime.date(2025, 2, 28),
 datetime.date(2025, 8, 31),
 datetime.date(2026, 2, 28),
 datetime.date(2026, 8, 31),
 datetime.date(2027, 2, 28),
 datetime.date(2027, 8, 31),
 datetime.date(2028, 2, 29),
 datetime.date(2028, 8, 31),
 datetime.date(2029, 2, 28),
 datetime.date(2029, 8, 31),
 datetime.date(2030, 2, 28)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-schedule-pay-dates-function">
<h2>The <font color='green'>schedule_pay_dates</font> function<a class="headerlink" href="#the-schedule-pay-dates-function" title="Link to this heading">#</a></h2>
<p>The <font color='green'>scheduled_pay_dates</font> function requires the bond’s maturity date (a <font color='green'>datetime</font> or <font color='green'>date</font> object) as its argument. By default, the settlement date is the current date, and the payment frequency is set to ‘2’ for semi-annual payments. The <font color='green'>validated_date</font> function is used to validate the provided maturity and settlement dates</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">scheduled_pay_dates</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span><span class="n">settlement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generates a chronological list of coupon payment dates from settlement to maturity.</span>
<span class="sd">    The function calculates dates backward from the maturity date based on the</span>
<span class="sd">    specified frequency. It handles standard bond market &quot;end-of-month&quot; logic:</span>
<span class="sd">    if the maturity date is the last day of a month, all preceding coupon payments</span>
<span class="sd">    are snapped to the last day of their respective months.</span>
<span class="sd">    Args:</span>
<span class="sd">        maturity (datetime.date): The final maturity date of the bond.</span>
<span class="sd">            Accepts a date object.</span>
<span class="sd">        settlement (datetime.date, optional): The settlement date (start of analysis).</span>
<span class="sd">            Coupons falling before this date are excluded. Defaults to date.today().</span>
<span class="sd">        freq (int, optional): The number of coupon payments per year.</span>
<span class="sd">            Accepted values:</span>
<span class="sd">            * 1: Annual, 2: Semi-Annual (Default), 4: Quarterly, 12: Monthly</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[datetime.date]: A list of coupon dates sorted chronologically</span>
<span class="sd">        (earliest to latest), ending with the maturity date..</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span><span class="n">date</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>

  <span class="c1">#Validate the data- maturity, coupon, settlement, freq</span>
  <span class="c1">#maturity</span>
  <span class="n">maturity</span><span class="o">=</span><span class="n">validate_date</span><span class="p">(</span><span class="n">maturity</span><span class="p">)</span>

  <span class="c1">#settlement</span>
  <span class="k">if</span> <span class="n">settlement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">settlement</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="n">settlement</span><span class="o">=</span><span class="n">validate_date</span><span class="p">(</span><span class="n">settlement</span><span class="p">)</span>
  <span class="c1">#freq</span>
  <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">]:</span>
      <span class="n">display</span><span class="p">(</span><span class="n">md</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### ⚠️  your assigned freq </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2"> it must be (1, 2, 4, or 12)</span><span class="se">\</span>
<span class="s2">     </span><span class="se">\n</span><span class="s2">     semi-annual assumed (2).&quot;</span><span class="p">))</span>
      <span class="n">freq</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

  <span class="c1"># Calculate the number of months between each coupon payment.</span>
  <span class="n">num_months</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">12</span><span class="o">/</span><span class="n">freq</span><span class="p">)</span>

  <span class="c1">#Need to check for month_end</span>
  <span class="n">is_month_end</span> <span class="o">=</span> <span class="n">maturity</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">maturity</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

  <span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">pay_date</span> <span class="o">=</span> <span class="n">maturity</span>

  <span class="c1">#Loop backward from the maturity date</span>

  <span class="k">while</span> <span class="n">pay_date</span> <span class="o">&gt;</span> <span class="n">settlement</span><span class="p">:</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pay_date</span><span class="p">)</span>

    <span class="c1"># Decrement by the frequency</span>
    <span class="n">pay_date</span> <span class="o">-=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>

    <span class="c1"># Handle Month End Logic</span>
    <span class="k">if</span> <span class="n">is_month_end</span><span class="p">:</span>
      <span class="n">last_day</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">pay_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">pay_date</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">pay_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="n">pay_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">pay_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">last_day</span><span class="p">)</span>

  <span class="c1"># Return chronologically (sliced backward)</span>
  <span class="k">return</span> <span class="n">dates</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-next-and-previous-scheduled-payment-dates">
<h2>The next and previous scheduled payment dates<a class="headerlink" href="#the-next-and-previous-scheduled-payment-dates" title="Link to this heading">#</a></h2>
<p>The <font color='green'>scheduled_pay_dates</font> function is used to determine the next and previous schedule payments.</p>
<p>Specifically:</p>
<ol class="arabic simple">
<li><p>The next scheduled payment date is the first date greater than or equal to the settlement date. It should be the first value in the list returned by <font color='green'>scheduled_pay_dates</font>.</p></li>
<li><p>The last scheduled payment date is calculated by taking the next scheduled payment date and subtracting the number of months between payments, while also accounting for the month-end adjustment.</p></li>
</ol>
<p>This calculation is demonstrated using the  <font color='green'>five_bonds</font> DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settlement</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>

<span class="c1"># Bond maturities on the index of the DataFrame</span>
<span class="c1"># Convert Pandas Timestamps to date object</span>
<span class="n">maturities</span><span class="o">=</span><span class="n">five_bonds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span>
<span class="n">freq</span><span class="o">=</span><span class="mi">2</span>
<span class="n">num_months</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">12</span><span class="o">/</span><span class="n">freq</span><span class="p">)</span>
<span class="c1">#Iterate through maturities</span>
<span class="k">for</span> <span class="n">maturity</span> <span class="ow">in</span> <span class="n">maturities</span><span class="p">:</span>
  <span class="c1"># First element of the list</span>
  <span class="n">next_coupon_date</span><span class="o">=</span><span class="n">scheduled_pay_dates</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span><span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
  <span class="c1"># relativedelta subtracts six months</span>
  <span class="n">previous_coupon_date</span><span class="o">=</span><span class="n">next_coupon_date</span><span class="o">-</span><span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>
  <span class="c1">#month-end adjustment if needed</span>
  <span class="n">is_month_end</span><span class="o">=</span><span class="n">maturity</span><span class="o">.</span><span class="n">day</span><span class="o">==</span><span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">maturity</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">is_month_end</span><span class="p">:</span>
    <span class="n">last_day</span><span class="o">=</span><span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">previous_coupon_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">previous_coupon_date</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">previous_coupon_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="n">previous_coupon_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">previous_coupon_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">last_day</span><span class="p">)</span>
  <span class="n">display</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;maturity </span><span class="si">{</span><span class="n">maturity</span><span class="si">}</span><span class="s1">--previous </span><span class="si">{</span><span class="n">previous_coupon_date</span><span class="si">}</span><span class="s1">--next </span><span class="si">{</span><span class="n">next_coupon_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;maturity 2025-02-28--previous 2024-08-31--next 2025-02-28&#39;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;maturity 2025-07-15--previous 2025-01-15--next 2025-07-15&#39;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;maturity 2025-08-31--previous 2024-08-31--next 2025-02-28&#39;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;maturity 2026-01-15--previous 2025-01-15--next 2025-07-15&#39;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;maturity 2028-02-29--previous 2024-08-31--next 2025-02-28&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="application-calculate-days-for-accrued-interest">
<h2><font color='green'>Application: Calculate days for accrued interest</font><a class="headerlink" href="#application-calculate-days-for-accrued-interest" title="Link to this heading">#</a></h2>
<div style="
    border-left: 12px solid green;
    line-height: 1.5;
    padding: 15px">
<br>
<p>Assume a bond matures on January 15<span class="math notranslate nohighlight">\(^{th}\)</span> 2030 and the settlement date is May 1<span class="math notranslate nohighlight">\(^{st}\)</span> 2024.  Calculate the number of days since the last coupon payment and the number of days between the last and next coupon payment. see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Hints.html#calculate-days-between-coupon-payment-and-settlement-dates">Chapter Two Calculate Days For Accrued Interest</a>, and check the <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Results.html#calculate-days-between-coupon-payment-and-settlement-dates">expected results here</a>.</p>
<br>
</div></section>
<section id="id1">
<h2>Calculating accrued interest<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>Calculating the number of days between or since payments is typically a straightforward subtraction of dates. The “Actual/Actual,” “Actual/365,” and “Actual/360” day-count conventions are simple to compute-a difference between two date objects; the “30/360” convention requires a more specialized approach dealt with  by the function <font color='green'>convert_30_360</font>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">convert_30_360</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>

    <span class="n">start_date</span> <span class="o">=</span> <span class="n">validate_date</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">validate_date</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>

    <span class="n">d1</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span>
    <span class="n">d2</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_last_day_of_feb</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">end_date</span><span class="p">):</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="k">if</span> <span class="n">d1</span> <span class="o">==</span> <span class="mi">31</span> <span class="ow">or</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">start_date</span><span class="p">):</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="k">if</span> <span class="n">d2</span> <span class="o">==</span> <span class="mi">31</span> <span class="ow">and</span> <span class="n">d1</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="n">day_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">360</span> <span class="o">+</span> <span class="p">(</span><span class="n">m2</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="p">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">day_count</span>
</pre></div>
</div>
<p>Here are examples illustrating the differences in day count using the 30/360 convention:</p>
<ul class="simple">
<li><p><strong>January 21, 2025, to August 31, 2024:</strong></p>
<ul>
<li><p>30/360 convention: 140 days</p></li>
<li><p>Actual: 143 days</p></li>
</ul>
</li>
<li><p><strong>February 28, 2025, to August 31, 2024:</strong></p>
<ul>
<li><p>30/360 convention: 180 days</p></li>
<li><p>Actual: 181 days</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">convert_30_360</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Calculates the number of days between two dates using the 30/360</span>
<span class="sd">  (US Bond Basis) convention.</span>

<span class="sd">  Args:</span>
<span class="sd">      start_date: The beginning date of the period.</span>
<span class="sd">      end_date: The ending date of the period.</span>

<span class="sd">  Returns:</span>
<span class="sd">      The number of days calculated using the 30/360 convention.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>

  <span class="c1">#Validate data</span>
  <span class="c1">#start_date</span>
  <span class="n">start_date</span><span class="o">=</span><span class="n">validate_date</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>

  <span class="c1">#end_date</span>
  <span class="n">end_date</span><span class="o">=</span><span class="n">validate_date</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>

  <span class="n">d1</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span>
  <span class="n">d2</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span>

  <span class="c1"># Helper to check if a date is the last day of February</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">is_last_day_of_feb</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

  <span class="c1"># --- Apply the 30/360 rules ---</span>

  <span class="c1">#  If both dates are the last day of Feb, change end_date&#39;s day to 30.</span>
  <span class="k">if</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">end_date</span><span class="p">):</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="mi">30</span>

  <span class="c1">#  If start_date is 31 or last day of Feb, change its day to 30.</span>
  <span class="k">if</span> <span class="n">d1</span> <span class="o">==</span> <span class="mi">31</span> <span class="ow">or</span> <span class="n">is_last_day_of_feb</span><span class="p">(</span><span class="n">start_date</span><span class="p">):</span>
      <span class="n">d1</span> <span class="o">=</span> <span class="mi">30</span>

  <span class="c1"># If end_date is 31 AND start_date&#39;s day was changed to 30, change end_date&#39;s day to 30.</span>
  <span class="k">if</span> <span class="n">d2</span> <span class="o">==</span> <span class="mi">31</span> <span class="ow">and</span> <span class="n">d1</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="mi">30</span>

  <span class="c1"># --- Perform the final calculation ---</span>
  <span class="n">day_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">360</span> <span class="o">+</span> <span class="p">(</span><span class="n">m2</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="p">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">day_count</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-accrued-interest-function">
<h2>The accrued_interest function<a class="headerlink" href="#the-accrued-interest-function" title="Link to this heading">#</a></h2>
<p>Accrued interest is determined by the annual coupon, adjusted by the payment frequency, and then multiplied by a fraction representing the time elapsed since the last payment. This time fraction is calculated as the ratio of days since the last payment to the total days between payments, with the specific calculation method depending on the day-count convention.</p>
<p>The function <font color='green'>scheduled_pay_dates</font> generate a series of future payment dates. If the function is passed the bond’s <strong>maturity date</strong> along with the settlement date, it returns a complete list of <em>all</em> scheduled payments between the settlement date and the maturity date (e.g., all 11 subsequent payments for a 5.5-year semi-annual bond). Although technically correct, generating all scheduled dates is computationally inefficient when the requirement is only the <em>immediate</em> next payment date.</p>
<p>To enhance performance and ensure a single date output, the true maturity date in the <font color='green'>scheduled_pay_dates</font> function is strategically replaced with a substitute date in the argument list. Rather than supplying a date several years in the future, the function is passed the minimum of the actual maturity date and the <strong>maturity month and day</strong> occurring in the year <em>immediately following</em> the settlement year.</p>
<p><strong>Example of Strategic Date Argument:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Bond’s True Data</p></th>
<th class="head"><p>Settlement Date</p></th>
<th class="head"><p>Strategic Argument</p></th>
<th class="head"><p>Rationale</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Maturity Date</strong></p></td>
<td><p>August 31, 2030</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>Too far in the future; generates excessive data.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Settlement Date</strong></p></td>
<td><p>N/A</p></td>
<td><p>January 21, 2025</p></td>
<td><p>N/A</p></td>
<td><p>Defines the starting point for the search.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Date Argument Passed to Function</strong></p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p><strong>August 31, 2026</strong></p></td>
<td><p>This date is guaranteed to fall after the next one or two coupon payment dates (depending on frequency) without generating the full schedule up to 2030.</p></td>
</tr>
</tbody>
</table>
</div>
<p>By passing <strong>August 31, 2026</strong>, the <font color='green'>scheduled_pay_dates</font> function will search for payments between January 21, 2025, and August 31, 2026. This limited scope ensures that the <em>first</em> date returned by the function will be the desired <strong>next coupon payment date</strong>, which is the sole piece of information required for the transaction settlement.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">accrued_interest</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span> <span class="n">coupon</span><span class="p">,</span> <span class="n">day_type</span><span class="o">=</span><span class="s1">&#39;Actual/Actual&#39;</span><span class="p">,</span> <span class="n">settlement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Returns the accrued interest for a bond.  Returns the accrued interest for a bond.</span>

<span class="sd">    Args:</span>
<span class="sd">        maturity (datetime): The maturity date of the bond.</span>
<span class="sd">        coupon (float): The annual coupon rate (e.g., 0.05 for 5%).</span>
<span class="sd">        day_types:</span>
<span class="sd">            Actual/Actual, Actual/365, Actual/360. and 30/360.</span>
<span class="sd">        settlement (datetime, optional): The settlement date. Defaults to today.</span>
<span class="sd">        freq (int, optional):</span>
<span class="sd">        Coupon frequency per year: 1 (annual). 2 (semi-annual)</span>
<span class="sd">                                    4 (quarterly), 12 (monthly)</span>
<span class="sd">                                    Defaults to 2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>
    <span class="c1">#Validate Data</span>
    <span class="n">maturity</span> <span class="o">=</span> <span class="n">validate_date</span><span class="p">(</span><span class="n">maturity</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">settlement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">settlement</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">settlement</span> <span class="o">=</span> <span class="n">validate_date</span><span class="p">(</span><span class="n">settlement</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">freq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠️ Warning: Freq </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2"> invalid. Assumed Semi-Annual (2).&quot;</span><span class="p">)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">coupon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coupon</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coupon</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Coupon must be a positive number.&quot;</span><span class="p">)</span>

    <span class="c1"># Define strategic_date</span>
    <span class="c1"># Get all the bond&#39;s potential payment dates in the next year</span>
    <span class="n">mat_is_last</span><span class="o">=</span><span class="n">maturity</span><span class="o">.</span><span class="n">day</span><span class="o">==</span><span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">maturity</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mat_is_last</span><span class="p">:</span>
      <span class="n">lastDay</span><span class="o">=</span><span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">settlement</span><span class="o">.</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">strategic_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="n">settlement</span><span class="o">.</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">lastDay</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
     <span class="n">strategic_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="n">settlement</span><span class="o">.</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">maturity</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>

    <span class="c1">#The strategic date: minimum of actual and next year&#39;s maturity date</span>
    <span class="n">strategic_date</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span><span class="n">strategic_date</span><span class="p">)</span>
    <span class="n">pay_dates</span> <span class="o">=</span> <span class="n">scheduled_pay_dates</span><span class="p">(</span><span class="n">strategic_date</span><span class="p">,</span> <span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>

    <span class="c1"># Should sorted but check</span>
    <span class="n">pay_dates</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c1"># The first date after the settlement date is the next coupon date</span>
    <span class="n">next_coupon</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pay_dates</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">settlement</span><span class="p">:</span>
            <span class="n">next_coupon</span> <span class="o">=</span> <span class="n">d</span>
            <span class="k">break</span>

    <span class="c1"># Bond has matured or annual coupon is zero</span>
    <span class="k">if</span> <span class="n">next_coupon</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">coupon</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="c1">#Calculate Previous Coupon Date</span>
    <span class="n">num_months</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">12</span> <span class="o">//</span> <span class="n">freq</span><span class="p">)</span>
    <span class="n">prev_coupon</span> <span class="o">=</span> <span class="n">next_coupon</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">num_months</span><span class="p">)</span>

    <span class="c1"># Check for Month End adjustment on the calculated previous date</span>
    <span class="n">is_next_month_end</span> <span class="o">=</span> <span class="n">next_coupon</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">maturity</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">maturity</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">is_next_month_end</span><span class="p">:</span>
        <span class="n">last_day_of_prev_month</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">prev_coupon</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">prev_coupon</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">prev_coupon</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="n">prev_coupon</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">prev_coupon</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">last_day_of_prev_month</span><span class="p">)</span>

    <span class="c1"># In Python date math, (Settlement - Prev) automatically excludes the end date,</span>
    <span class="c1"># which correctly represents &quot;days held&quot;.</span>

    <span class="n">accrued_value</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="n">day_type</span> <span class="o">==</span> <span class="s1">&#39;Actual/Actual&#39;</span><span class="p">:</span>
        <span class="n">days_since_last</span> <span class="o">=</span> <span class="p">(</span><span class="n">settlement</span> <span class="o">-</span> <span class="n">prev_coupon</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="n">days_between</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_coupon</span> <span class="o">-</span> <span class="n">prev_coupon</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="c1"># Formula: Coupon/Freq * (DaysHeld / DaysInPeriod)</span>
        <span class="n">accrued_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">coupon</span> <span class="o">/</span> <span class="n">freq</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">days_since_last</span> <span class="o">/</span> <span class="n">days_between</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">day_type</span> <span class="o">==</span> <span class="s1">&#39;30/360&#39;</span><span class="p">:</span>
        <span class="n">days_since_last</span> <span class="o">=</span> <span class="n">_days_30_360</span><span class="p">(</span><span class="n">prev_coupon</span><span class="p">,</span> <span class="n">settlement</span><span class="p">)</span>
        <span class="c1"># Formula: Coupon * (Days360 / 360)</span>
        <span class="n">accrued_value</span> <span class="o">=</span> <span class="n">coupon</span> <span class="o">*</span> <span class="p">(</span><span class="n">days_since_last</span> <span class="o">/</span> <span class="mf">360.0</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">day_type</span> <span class="o">==</span> <span class="s1">&#39;Actual/360&#39;</span><span class="p">:</span>
        <span class="n">days_since_last</span> <span class="o">=</span> <span class="p">(</span><span class="n">settlement</span> <span class="o">-</span> <span class="n">prev_coupon</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="n">accrued_value</span> <span class="o">=</span> <span class="n">coupon</span> <span class="o">*</span> <span class="p">(</span><span class="n">days_since_last</span> <span class="o">/</span> <span class="mf">360.0</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">day_type</span> <span class="o">==</span> <span class="s1">&#39;Actual/365&#39;</span><span class="p">:</span>
        <span class="n">days_since_last</span> <span class="o">=</span> <span class="p">(</span><span class="n">settlement</span> <span class="o">-</span> <span class="n">prev_coupon</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="n">accrued_value</span> <span class="o">=</span> <span class="n">coupon</span> <span class="o">*</span> <span class="p">(</span><span class="n">days_since_last</span> <span class="o">/</span> <span class="mf">365.0</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fallback</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠️ Warning: Unknown day_type </span><span class="si">{</span><span class="n">day_type</span><span class="si">}</span><span class="s2">. Using Actual/Actual.&quot;</span><span class="p">)</span>
        <span class="n">days_since_last</span> <span class="o">=</span> <span class="p">(</span><span class="n">settlement</span> <span class="o">-</span> <span class="n">prev_coupon</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="n">days_between</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_coupon</span> <span class="o">-</span> <span class="n">prev_coupon</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="n">accrued_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">coupon</span> <span class="o">/</span> <span class="n">freq</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">days_since_last</span> <span class="o">/</span> <span class="n">days_between</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">accrued_value</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculating-accrued-interest-for-five-bonds-dataframe">
<h2>Calculating accrued interest for <font color='green'>five_bonds</font> DataFrame<a class="headerlink" href="#calculating-accrued-interest-for-five-bonds-dataframe" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maturities</span><span class="o">=</span><span class="n">five_bonds</span><span class="o">.</span><span class="n">index</span>
<span class="n">coupons</span><span class="o">=</span><span class="n">five_bonds</span><span class="p">[</span><span class="s1">&#39;Coupon&#39;</span><span class="p">]</span>
<span class="n">settlement</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>
<span class="n">freq</span><span class="o">=</span><span class="mi">2</span>
<span class="k">for</span> <span class="n">maturity</span><span class="p">,</span><span class="n">coupon</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">maturities</span><span class="p">,</span><span class="n">coupons</span><span class="p">):</span>
  <span class="n">bond_accrued_interest</span><span class="o">=</span><span class="n">accrued_interest</span><span class="p">(</span><span class="n">maturity</span><span class="p">,</span><span class="n">coupon</span><span class="p">,</span>
                                         <span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span><span class="p">,</span>
                                         <span class="n">freq</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">display</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Maturity </span><span class="si">{</span><span class="n">maturity</span><span class="si">}</span><span class="s1">---Coupon </span><span class="si">{</span><span class="n">coupon</span><span class="si">}</span><span class="s1">--</span><span class="se">\</span>
<span class="s1">  Accrued Interest </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">bond_accrued_interest</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Maturity 2025-02-28 00:00:00---Coupon 1.125--  Accrued Interest 0.444&#39;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Maturity 2025-07-15 00:00:00---Coupon 3.0--  Accrued Interest 0.05&#39;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Maturity 2025-08-31 00:00:00---Coupon 0.25--  Accrued Interest 0.099&#39;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Maturity 2026-01-15 00:00:00---Coupon 3.875--  Accrued Interest 0.064&#39;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Maturity 2028-02-29 00:00:00---Coupon 4.0--  Accrued Interest 1.587&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-the-apply-method-to-add-accrured-interest-to-the-bond-data-304-bonds-dataframe">
<h2>Using the <font color='green'>apply</font> method to add accrured interest to the <font color='green'>bond_data</font> (304 bonds) DataFrame.<a class="headerlink" href="#using-the-apply-method-to-add-accrured-interest-to-the-bond-data-304-bonds-dataframe" title="Link to this heading">#</a></h2>
<p>The <font color='green'>apply</font> method eliminates the need to iterate through all the values of a row or column. While many examples can be vectorized by operating directly on columns, <font color='green'>apply</font> is particularly useful for complex scenarios, such as calculating accrued interest, where column-wise operations are not feasible.<span class="math notranslate nohighlight">\(^{5}\)</span></p>
<p>The benefits of using <font color='green'>apply</font>  include:</p>
<ol class="arabic simple">
<li><p><strong>Direct Column Access:</strong> The lambda function can directly access specific columns within each row.</p></li>
<li><p><strong>Simplified Code:</strong> It leads to less complex and more easily understandable code.</p></li>
</ol>
<p>The method is demonstrated with the DataFrame of Chapter One, <font color='green'>rows_to_columns</font>.  The examples could be solved with column operations, but their simplicity makes the use of <font color='green'>apply</font> clear.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rows_to_columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Rates&#39;</span><span class="p">:[</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.07</span><span class="p">],</span>
                              <span class="s1">&#39;Future Values&#39;</span><span class="p">:[</span><span class="mf">1.030455</span><span class="p">,</span><span class="mf">1.05171</span><span class="p">,</span><span class="mf">1.072508</span><span class="p">],</span>
                              <span class="s1">&#39;Present Value&#39;</span><span class="p">:[</span><span class="mf">0.970446</span><span class="p">,</span><span class="mf">0.951229</span><span class="p">,</span><span class="mf">0.93294</span><span class="p">]})</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
<span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Discrete&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">rows_to_columns</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Rates&#39;</span><span class="p">]),</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
<span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Log Future Values&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Future Values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(^{5}\)</span> <a class="reference external" href="https://patrickjhess.github.io/Introduction-To-Python-For-Financial-Python/An_Introduction_To_Pandas.html#the-apply-method">Pandas method apply</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create rows_to_columns DataFrame</span>
<span class="n">rows_to_columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Rates&#39;</span><span class="p">:[</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.07</span><span class="p">],</span>
                              <span class="s1">&#39;Future Values&#39;</span><span class="p">:[</span><span class="mf">1.030455</span><span class="p">,</span><span class="mf">1.05171</span><span class="p">,</span><span class="mf">1.072508</span><span class="p">],</span>
                              <span class="s1">&#39;Present Value&#39;</span><span class="p">:[</span><span class="mf">0.970446</span><span class="p">,</span><span class="mf">0.951229</span><span class="p">,</span><span class="mf">0.93294</span><span class="p">]})</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
<span class="c1"># Access the value of rows</span>
<span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Discrete&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">rows_to_columns</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Rates&#39;</span><span class="p">]),</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
<span class="c1"># Access the values of column</span>
<span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Log Future Values&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rows_to_columns</span><span class="p">[</span><span class="s1">&#39;Future Values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">rows_to_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rates</th>
      <th>Future Values</th>
      <th>Present Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.03</td>
      <td>1.030455</td>
      <td>0.970446</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.05</td>
      <td>1.051710</td>
      <td>0.951229</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.07</td>
      <td>1.072508</td>
      <td>0.932940</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rates</th>
      <th>Future Values</th>
      <th>Present Value</th>
      <th>Discrete</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.03</td>
      <td>1.030455</td>
      <td>0.970446</td>
      <td>0.029559</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.05</td>
      <td>1.051710</td>
      <td>0.951229</td>
      <td>0.048790</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.07</td>
      <td>1.072508</td>
      <td>0.932940</td>
      <td>0.067659</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rates</th>
      <th>Future Values</th>
      <th>Present Value</th>
      <th>Discrete</th>
      <th>Log Future Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.03</td>
      <td>1.030455</td>
      <td>0.970446</td>
      <td>0.029559</td>
      <td>0.030000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.05</td>
      <td>1.051710</td>
      <td>0.951229</td>
      <td>0.048790</td>
      <td>0.050417</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.07</td>
      <td>1.072508</td>
      <td>0.932940</td>
      <td>0.067659</td>
      <td>0.070000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="update-bond-data-with-accrued-interest">
<h2>Update <font color='green'>bond_data</font> with accrued interest<a class="headerlink" href="#update-bond-data-with-accrued-interest" title="Link to this heading">#</a></h2>
<p>The DataFrame <font color='green'>bond_data</font> is expanded by applying the <font color='green'>accurred_interest</font> function to each row of <font color='green'>bond_data</font>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bond_data</span><span class="p">[</span><span class="s1">&#39;Accrued&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond_data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">accrued_interest</span><span class="p">(</span>
        <span class="n">maturity</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>      <span class="c1"># The row&#39;s index label (maturity date) is accessed via .name</span>
        <span class="n">coupon</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Coupon&#39;</span><span class="p">],</span>   <span class="c1"># Access the &#39;Coupon&#39; value from the row</span>
        <span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span>   <span class="c1"># Use the globally defined settlement date</span>
    <span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settlement</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>
<span class="c1"># Use DataFrame.apply() to create the new column</span>
<span class="c1"># &#39;axis=1&#39; tells pandas to apply the function to each row.</span>
<span class="c1"># A lambda function is used to pass the correct columns from each row to accrued_interest.</span>
<span class="n">bond_data</span><span class="p">[</span><span class="s1">&#39;Accrued&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond_data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">accrued_interest</span><span class="p">(</span>
        <span class="n">maturity</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>      <span class="c1"># The row&#39;s index label (maturity date) is accessed via .name</span>
        <span class="n">coupon</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Coupon&#39;</span><span class="p">],</span>   <span class="c1"># Access the &#39;Coupon&#39; value from the row</span>
        <span class="n">settlement</span><span class="o">=</span><span class="n">settlement</span>   <span class="c1"># Use the globally defined settlement date</span>
    <span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">bond_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
      <th>Coupon</th>
      <th>Price Bid</th>
      <th>Price Ask</th>
      <th>Bid Size</th>
      <th>Ask Size</th>
      <th>Accrued</th>
    </tr>
    <tr>
      <th>Maturity Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2025-01-28</th>
      <td>UNITED STATES TREAS BILLS ZERO CPN       0.000...</td>
      <td>0.000</td>
      <td>99.929</td>
      <td>99.930</td>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2025-01-30</th>
      <td>UNITED STATES TREAS BILLS ZERO CPN       0.000...</td>
      <td>0.000</td>
      <td>99.906</td>
      <td>99.907</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER U-2025          1.3750...</td>
      <td>1.375</td>
      <td>99.921</td>
      <td>99.934</td>
      <td>60000.0</td>
      <td>60000.0</td>
      <td>0.650136</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER AW-2025         4.1250...</td>
      <td>4.125</td>
      <td>99.988</td>
      <td>99.997</td>
      <td>60000.0</td>
      <td>60000.0</td>
      <td>1.950408</td>
    </tr>
    <tr>
      <th>2025-01-31</th>
      <td>UNITED STATES TREAS SER G-2025          2.5000...</td>
      <td>2.500</td>
      <td>99.953</td>
      <td>99.965</td>
      <td>60000.0</td>
      <td>60000.0</td>
      <td>1.182065</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2029-11-30</th>
      <td>UNITED STATES TREAS SER AG-2029         4.1250...</td>
      <td>4.125</td>
      <td>98.910</td>
      <td>98.914</td>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>0.589286</td>
    </tr>
    <tr>
      <th>2029-11-30</th>
      <td>UNITED STATES TREAS SER S-2029          3.8750...</td>
      <td>3.875</td>
      <td>97.763</td>
      <td>97.782</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>0.553571</td>
    </tr>
    <tr>
      <th>2029-12-31</th>
      <td>UNITED STATES TREAS SER T-2029          3.8750...</td>
      <td>3.875</td>
      <td>97.734</td>
      <td>97.738</td>
      <td>65000.0</td>
      <td>65000.0</td>
      <td>0.234203</td>
    </tr>
    <tr>
      <th>2029-12-31</th>
      <td>UNITED STATES TREAS SER AH-2029         4.3750...</td>
      <td>4.375</td>
      <td>99.988</td>
      <td>99.989</td>
      <td>7000.0</td>
      <td>7000.0</td>
      <td>0.264423</td>
    </tr>
    <tr>
      <th>2030-01-31</th>
      <td>UNITED STATES TREAS SER G-2030          3.5000...</td>
      <td>3.500</td>
      <td>95.994</td>
      <td>96.011</td>
      <td>16000.0</td>
      <td>16000.0</td>
      <td>1.654891</td>
    </tr>
  </tbody>
</table>
<p>304 rows × 7 columns</p>
</div></div></div>
</div>
</section>
<section id="application-calculate-a-transaction-price">
<h2><font color='green'>Application: Calculate a transaction price</font><a class="headerlink" href="#application-calculate-a-transaction-price" title="Link to this heading">#</a></h2>
<div style="
    border-left: 12px solid green;
    line-height: 1.5;
    padding: 15px">
<br>
<p>Assume a bond matures on January 15<span class="math notranslate nohighlight">\(^{th}\)</span> 2030 and the settlement date is May 1<span class="math notranslate nohighlight">\(^{st}\)</span> 2024. The bond’s clean quoted price is $95 and the coupon is 5.0. see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Hints.html#calculate-a-transaction-price">Chapter Two Hints:Calculate A Transaction Price</a>, and check the <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Results.html#calculate-a-transaction-price">expected results here</a>.</p>
<br>
</div>
</section>
<section id="creating-the-workbook">
<h2>Creating the workbook<a class="headerlink" href="#creating-the-workbook" title="Link to this heading">#</a></h2>
<p>The <font color='green'>create_workbook</font> function transforms the bond_data DataFrame into an Excel workbook. It takes the sheet name, DataFrame name, and the dictionary <font color='green'>save_config</font>  as arguments. The sheet and DataFrame names are required, while save_config defaults to an empty dictionary. When <font color='green'>save_config</font> is not specified, the workbook is created in the current working directory of the notebook.<span class="math notranslate nohighlight">\(^{6}\)</span></p>
<p>Note: The working directory for a Jupyter notebook is its current folder. For a Colab notebook, the location is ‘contents’ and is only available during runtime.</p>
<p><span class="math notranslate nohighlight">\(^{6}\)</span> The <font color='green'>create_workbook</font> function utilizes the <font color='green'>save_results</font> function located in the <font color='green'>basic_concepts_fixed_income</font> module.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">save_config</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="s1">&#39;Basic Concepts Of Fixed Income&#39;</span><span class="p">,</span>
                 <span class="n">chapter</span><span class="o">=</span><span class="s1">&#39;Accrued Interest&#39;</span><span class="p">,</span>
                 <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;Accrued Interest.xlsx&#39;</span><span class="p">)</span>
<span class="n">create_workbook</span><span class="p">(</span><span class="s1">&#39;Basic Bond Data&#39;</span><span class="p">,</span><span class="n">bond_data</span><span class="p">,</span><span class="n">save_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h3 class="rubric" id="successfully-wrote-and-formatted-sheet-basic-bond-data-in-accrued-interest-xlsx"><em><strong>✅ Successfully wrote and formatted sheet Basic Bond Data in Accrued Interest.xlsx</strong></em></h3>
</div>
</div>
</section>
<section id="application-create-an-excel-workbook">
<h2><font color='green'>Application: Create an Excel workbook</font><a class="headerlink" href="#application-create-an-excel-workbook" title="Link to this heading">#</a></h2>
<div style="
    border-left: 12px solid green;
    line-height: 1.5;
    padding: 15px">
<br>
<p>Use the first ten rows of bond_data to create the workbook ‘Test Data’ and save it to the worksheet ‘Ten Rows Of Data’ see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Hints.html#create-a-workbook">Chapter Two Hints: Create A Workbook</a>, and check the <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Results.html#create-a-workbook">expected results here</a>.</p>
<br>
</div>
</section>
<section id="chapter-exercise">
<h2><span style="text-align: left; color:green; font-family: 'Franklin Gothic Medium', sans-serif; margin-top: 1.0em; margin-bottom: 0em; font-style: italic;">Chapter Exercise</span><a class="headerlink" href="#chapter-exercise" title="Link to this heading">#</a></h2>
<p><span style="text-align: left; color:green; font-family: 'Franklin Gothic Medium', sans-serif; margin-top: 0; margin-bottom: 0.5em; font-style: italic;"><big><font color='black'>Create a workbook with accrued Interest For 100 Bonds</big></font></span></p>
<p><span style="display:block;
    border-left: 12px solid green;
    font-family: 'Garamond', serif;
    line-height: 1.5;
    padding: 15px">
<big>Use bond_jan_21_2025.xlsx for the exercise</big><br></span>
<span style="display:block;
    border-left: 12px solid green;
    font-family: 'Garamond', serif;
    line-height: 2;">
<br><big>          1. For the first 100 rows of the workbook calculate the accrued interest and save it in a new DataFrame.<br><br>          2. Save the new DataFrame as an Excel Workbook..</big><br></span>
<span style="display:block;
    border-left: 12px solid green;
    font-family: 'Garamond', serif;
    line-height: 1.5;
    padding: 15px">
<br><big>For hints, see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Hints.html#chapter-two-exercise">Chapter Two Hints</a>. For expected results, see <a class="reference external" href="https://patrickjhess.github.io/Hints-Results/Chapter_Two_Results.html#chapter-two-exercise">Chapter Two Expected Results</a>.</big></p>
</span></section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "PatrickJHess/Vol-3-Chap-2-Chap-3",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Dealing_With_Dates.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Manipulating Dates</p>
      </div>
    </a>
    <a class="right-next"
       href="Chapter_Two_Summary.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Updating Quoted Bond Prices with Accrued Interest</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-notebook">Preparing the notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-libraries-modules-and-functions">Importing libraries, modules, And functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-a-custom-module-and-importing-functions">Adding a custom module and importing functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-the-dataframe-bond-data">Creating the DataFrame bond_data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validating-dates-and-converting-datetime-to-date">Validating dates and converting <font color="green">datetime</font> to <font color="green">date</font>.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#illustrating-accrued-interest-with-five-unique-maturity-dates">Illustrating accrued interest with five unique maturity dates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-access-bonds-with-specific-characteristics"><font color="green">Application Access bonds with specific characteristics</font></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scheduled-payment-dates">Scheduled payment dates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-schedule-pay-dates-function">The <font color="green">schedule_pay_dates</font> function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-next-and-previous-scheduled-payment-dates">The next and previous scheduled payment dates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-calculate-days-for-accrued-interest"><font color="green">Application: Calculate days for accrued interest</font></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Calculating accrued interest</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-accrued-interest-function">The accrued_interest function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-accrued-interest-for-five-bonds-dataframe">Calculating accrued interest for <font color="green">five_bonds</font> DataFrame</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-apply-method-to-add-accrured-interest-to-the-bond-data-304-bonds-dataframe">Using the <font color="green">apply</font> method to add accrured interest to the <font color="green">bond_data</font> (304 bonds) DataFrame.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-bond-data-with-accrued-interest">Update <font color="green">bond_data</font> with accrued interest</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-calculate-a-transaction-price"><font color="green">Application: Calculate a transaction price</font></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-the-workbook">Creating the workbook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-create-an-excel-workbook"><font color="green">Application: Create an Excel workbook</font></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-exercise"><span style="text-align: left; color:green; font-family: 'Franklin Gothic Medium', sans-serif; margin-top: 1.0em; margin-bottom: 0em; font-style: italic;">Chapter Exercise</span></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Financial Python
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025 by the University of Virginia Darden School Foundation, Charlottesville, VA..
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>